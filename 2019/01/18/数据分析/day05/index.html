<!DOCTYPE HTML>
<html>

<head><meta name="generator" content="Hexo 3.8.0">
	<link rel="bookmark" type="image/x-icon" href="/img/logo_miccall.png">
	<link rel="shortcut icon" href="/img/logo_miccall.png">
	
			    <title>
    ytq520
    </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link rel="stylesheet" href="/css/mic_main.css">
    <link rel="stylesheet" href="/css/dropdownMenu.css">
    <meta name="keywords" content="miccall">
    
    	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	 
    <noscript>
        <link rel="stylesheet" href="/css/noscript.css">
    </noscript>
    <style type="text/css">
        body:before {
          content: ' ';
          position: fixed;
          top: 0;
          background: url('/img/bg.jpg') center 0 no-repeat;
          right: 0;
          bottom: 0;
          left: 0;
          background-size: cover; 
        }
    </style>

			    
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script async type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.scrollex.min.js"></script>
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/skel.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
	
</head>
    
		
<!-- Layouts -->



<!--  代码渲染  -->
<link rel="stylesheet" href="/css/prism_coy.css">
<link rel="stylesheet" href="/css/typo.css">
<!-- 文章页 -->
<body class="is-loading">
    <!-- Wrapper 外包 s-->
    <div id="wrapper" class="fade-in">
        <!-- Intro 头部显示 s -->
        <!-- Intro 头部显示 e -->
        <!-- Header 头部logo start -->
        <header id="header">
    <a href="/" class="logo">ytq520</a>
</header>
        <!-- Nav 导航条 start -->
        <nav id="nav" class="special">
            <ul class="menu links">
			<!-- Homepage  主页  --> 
			<li>
	            <a href="/" rel="nofollow">主页</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">分类</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="category-link" href="/categories/Data-Analysis/">Data Analysis</a></li><li><a class="category-link" href="/categories/Django/">Django</a></li><li><a class="category-link" href="/categories/Flask/">Flask</a></li><li><a class="category-link" href="/categories/JavaScript/">JavaScript</a></li><li><a class="category-link" href="/categories/MySQL/">MySQL</a></li><li><a class="category-link" href="/categories/html/">html</a></li><li><a class="category-link" href="/categories/python基础/">python基础</a>
	                    </li></ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/gallery/" title="图库">
		                图库
		            </a>
		        </li>
		        
		        <li>
		            <a href="/tag/" title="标签">
		                标签
		            </a>
		        </li>
		        


            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
                    
                    <li>
                        <a title="github" href="https://github.com/ytq520" target="_blank" rel="noopener">
                            <i class="icon fa fa-github"></i>
                        </a>
                    </li>
                    
                    <li>
                        <a title="500px" href="http://500px.com" target="_blank" rel="noopener">
                            <i class="icon fa fa-500px"></i>
                        </a>
                    </li>
                    
			</ul>
</nav>

        <div id="main">
            <div class="post_page_title_img" style="height: 25rem;background-image: url(/images/thumbs/16.jpg);background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;">
                <a href="#" style="padding: 4rem 4rem 2rem 4rem ;"><h2>数据规整：聚合、合并、重塑和上传文件数据到数据库</h2></a>
            </div>
            <!-- Post -->
            <div class="typo" style="padding: 3rem;">
                <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br></pre></td><td class="code"><pre><span class="line">数据分析 6 数据规整：聚合、合并和重塑</span><br><span class="line">在许多应⽤中，数据可能分散在许多⽂件或数据库中，存储的形式也不利于分析，应采⽤聚</span><br><span class="line">合、合并、重塑数据的⽅法进⾏处理。</span><br><span class="line">层次化索引</span><br><span class="line">层次化索引（hierarchical indexing）是pandas的⼀项重要功能，它使你能在⼀个轴上拥有多</span><br><span class="line">个（两个以上）索引级别。</span><br><span class="line">In [9]: data = pd.Series(np.random.randn(9),</span><br><span class="line"> ...: index=[[&apos;a&apos;, &apos;a&apos;, &apos;a&apos;, &apos;b&apos;, &apos;b&apos;, &apos;c&apos;, &apos;c&apos;, &apos;d&apos;, &apos;d&apos;],</span><br><span class="line"> ...: [1, 2, 3, 1, 3, 1, 2, 2, 3]])</span><br><span class="line">In [10]: data</span><br><span class="line">Out[10]:</span><br><span class="line">a 1 -0.204708</span><br><span class="line"> 2 0.478943</span><br><span class="line"> 3 -0.519439</span><br><span class="line">b 1 -0.555730</span><br><span class="line"> 3 1.965781</span><br><span class="line">c 1 1.393406</span><br><span class="line"> 2 0.092908</span><br><span class="line">d 2 0.281746</span><br><span class="line"> 3 0.769023</span><br><span class="line">dtype: float64</span><br><span class="line">In [12]: data[&apos;b&apos;]</span><br><span class="line">Out[12]:</span><br><span class="line">1 -0.555730</span><br><span class="line">3 1.965781</span><br><span class="line">dtype: float64</span><br><span class="line">In [13]: data[&apos;b&apos;:&apos;c&apos;]</span><br><span class="line">Out[13]:</span><br><span class="line">b 1 -0.555730</span><br><span class="line"> 3 1.965781</span><br><span class="line">c 1 1.393406</span><br><span class="line"> 2 0.092908</span><br><span class="line">dtype: float64</span><br><span class="line">In [14]: data.loc[[&apos;b&apos;, &apos;d&apos;]]</span><br><span class="line">Out[14]:</span><br><span class="line">b 1 -0.555730</span><br><span class="line"> 3 1.965781</span><br><span class="line">d 2 0.281746</span><br><span class="line"> 3 0.769023</span><br><span class="line">dtype: float64</span><br><span class="line">“内层”中进⾏选取</span><br><span class="line">In [15]: data.loc[:, 2]</span><br><span class="line">Out[15]:</span><br><span class="line">a 0.478943</span><br><span class="line">c 0.092908</span><br><span class="line">d 0.281746</span><br><span class="line">dtype: float64</span><br><span class="line">In [16]: data.unstack()</span><br><span class="line">Out[16]:</span><br><span class="line"> 1 2 3</span><br><span class="line">a -0.204708 0.478943 -0.519439</span><br><span class="line">b -0.555730 NaN 1.965781</span><br><span class="line">c 1.393406 0.092908 NaN</span><br><span class="line">d NaN 0.281746 0.769023</span><br><span class="line">unstack的逆运算是stack</span><br><span class="line">In [17]: data.unstack().stack()</span><br><span class="line">Out[17]:</span><br><span class="line">a 1 -0.204708</span><br><span class="line"> 2 0.478943</span><br><span class="line"> 3 -0.519439</span><br><span class="line">b 1 -0.555730</span><br><span class="line"> 3 1.965781</span><br><span class="line">c 1 1.393406</span><br><span class="line"> 2 0.092908</span><br><span class="line">d 2 0.281746</span><br><span class="line"> 3 0.769023</span><br><span class="line">dtype: float64</span><br><span class="line">对于⼀个DataFrame，每条轴都可以有分层索引</span><br><span class="line">In [18]: frame = pd.DataFrame(np.arange(12).reshape((4, 3)),</span><br><span class="line"> ....: index=[[&apos;a&apos;, &apos;a&apos;, &apos;b&apos;, &apos;b&apos;], [1, 2, 1, 2]],</span><br><span class="line"> ....: columns=[[&apos;Ohio&apos;, &apos;Ohio&apos;, &apos;Colorado&apos;],</span><br><span class="line"> ....: [&apos;Green&apos;, &apos;Red&apos;, &apos;Green&apos;]])</span><br><span class="line">In [19]: frame</span><br><span class="line">Out[19]:</span><br><span class="line"> Ohio Colorado</span><br><span class="line"> Green Red Green</span><br><span class="line">a 1 0 1 2</span><br><span class="line"> 2 3 4 5</span><br><span class="line">b 1 6 7 8</span><br><span class="line"> 2 9 10 11</span><br><span class="line">In [20]: frame.index.names = [&apos;key1&apos;, &apos;key2&apos;]</span><br><span class="line">In [21]: frame.columns.names = [&apos;state&apos;, &apos;color&apos;]</span><br><span class="line">In [22]: frame</span><br><span class="line">Out[22]:</span><br><span class="line">state Ohio Colorado</span><br><span class="line">color Green Red Green</span><br><span class="line">key1 key2</span><br><span class="line">a 1 0 1 2</span><br><span class="line"> 2 3 4 5</span><br><span class="line">b 1 6 7 8</span><br><span class="line"> 2 9 10 11</span><br><span class="line">有了部分列索引，因此可以轻松选取列分组</span><br><span class="line">In [23]: frame[&apos;Ohio&apos;]</span><br><span class="line">Out[23]:</span><br><span class="line">color Green Red</span><br><span class="line">key1 key2</span><br><span class="line">a 1 0 1</span><br><span class="line"> 2 3 4</span><br><span class="line">b 1 6 7</span><br><span class="line"> 2 9 10</span><br><span class="line">重排与分级排序</span><br><span class="line">调整某条轴上各级别的顺序</span><br><span class="line">In [24]: frame.swaplevel(&apos;key1&apos;, &apos;key2&apos;)</span><br><span class="line">Out[24]:</span><br><span class="line">state Ohio Colorado</span><br><span class="line">color Green Red Green</span><br><span class="line">key2 key1</span><br><span class="line">1 a 0 1 2</span><br><span class="line">2 a 3 4 5</span><br><span class="line">1 b 6 7 8</span><br><span class="line">2 b 9 10 11</span><br><span class="line">⽽sort_index则根据单个级别中的值对数据进⾏排序。交换级别时，常常也会⽤到</span><br><span class="line">sort_index，这样最终结果就是按照指定顺序进⾏字⺟排序了</span><br><span class="line">In [25]: frame.sort_index(level=1)</span><br><span class="line">Out[25]:</span><br><span class="line">state Ohio Colorado</span><br><span class="line">color Green Red Green</span><br><span class="line">key1 key2 </span><br><span class="line">a 1 0 1 2</span><br><span class="line">b 1 6 7 8</span><br><span class="line">a 2 3 4 5</span><br><span class="line">b 2 9 10 11</span><br><span class="line">In [26]: frame.swaplevel(0, 1).sort_index(level=0)</span><br><span class="line">Out[26]:</span><br><span class="line">state Ohio Colorado</span><br><span class="line">color Green Red Green</span><br><span class="line">key2 key1</span><br><span class="line">1 a 0 1 2</span><br><span class="line"> b 6 7 8</span><br><span class="line">2 a 3 4 5</span><br><span class="line"> b 9 10 11</span><br><span class="line">根据级别汇总统计</span><br><span class="line">对DataFrame和Series的描述和汇总统计都有⼀个level选项，它⽤于指定在某条轴上求和的级</span><br><span class="line">别。</span><br><span class="line">In [27]: frame.sum(level=&apos;key2&apos;)</span><br><span class="line">Out[27]:</span><br><span class="line">state Ohio Colorado</span><br><span class="line">color Green Red Green</span><br><span class="line">key2</span><br><span class="line">1 6 8 10</span><br><span class="line">2 12 14 16</span><br><span class="line">In [28]: frame.sum(level=&apos;color&apos;, axis=1)</span><br><span class="line">Out[28]:</span><br><span class="line">color Green Red</span><br><span class="line">key1 key2</span><br><span class="line">a 1 2 1</span><br><span class="line"> 2 8 4</span><br><span class="line">b 1 14 7</span><br><span class="line"> 2 20 10</span><br><span class="line">使⽤DataFrame的列进⾏索引</span><br><span class="line">将DataFrame的⼀个或多个列当做⾏索引来⽤，或者可能希望将⾏索引变成DataFrame的列</span><br><span class="line">In [29]: frame = pd.DataFrame(&#123;&apos;a&apos;: range(7), &apos;b&apos;: range(7, 0, -1),</span><br><span class="line"> ....: &apos;c&apos;: [&apos;one&apos;, &apos;one&apos;, &apos;one&apos;, &apos;two&apos;, &apos;two&apos;,</span><br><span class="line"> ....: &apos;two&apos;, &apos;two&apos;],</span><br><span class="line"> ....: &apos;d&apos;: [0, 1, 2, 0, 1, 2, 3]&#125;)</span><br><span class="line">In [30]: frame</span><br><span class="line">Out[30]:</span><br><span class="line"> a b c d</span><br><span class="line">0 0 7 one 0</span><br><span class="line">1 1 6 one 1</span><br><span class="line">2 2 5 one 2</span><br><span class="line">3 3 4 two 0</span><br><span class="line">4 4 3 two 1</span><br><span class="line">5 5 2 two 2</span><br><span class="line">6 6 1 two 3</span><br><span class="line">In [31]: frame2 = frame.set_index([&apos;c&apos;, &apos;d&apos;])</span><br><span class="line">In [32]: frame2</span><br><span class="line">Out[32]:</span><br><span class="line"> a b</span><br><span class="line">c d</span><br><span class="line">one 0 0 7</span><br><span class="line"> 1 1 6</span><br><span class="line"> 2 2 5</span><br><span class="line">two 0 3 4</span><br><span class="line"> 1 4 3</span><br><span class="line"> 2 5 2</span><br><span class="line"> 3 6 1</span><br><span class="line">默认情况下，那些列会从DataFrame中移除，但也可以将其保留下来</span><br><span class="line">In [33]: frame.set_index([&apos;c&apos;, &apos;d&apos;], drop=False)</span><br><span class="line">Out[33]:</span><br><span class="line"> a b c d</span><br><span class="line">c d</span><br><span class="line">one 0 0 7 one 0</span><br><span class="line"> 1 1 6 one 1</span><br><span class="line"> 2 2 5 one 2</span><br><span class="line">two 0 3 4 two 0</span><br><span class="line"> 1 4 3 two 1</span><br><span class="line"> 2 5 2 two 2</span><br><span class="line"> 3 6 1 two 3</span><br><span class="line">reset_index的功能跟set_index刚好相反，层次化索引的级别会被转移到列⾥⾯</span><br><span class="line">In [34]: frame2.reset_index()</span><br><span class="line">Out[34]:</span><br><span class="line">c d a b</span><br><span class="line">0 one 0 0 7</span><br><span class="line">1 one 1 1 6</span><br><span class="line">2 one 2 2 5</span><br><span class="line">3 two 0 3 4</span><br><span class="line">4 two 1 4 3</span><br><span class="line">5 two 2 5 2</span><br><span class="line">6 two 3 6 1</span><br><span class="line">合并数据集</span><br><span class="line">pandas对象中的数据可以通过⼀些⽅式进⾏合并</span><br><span class="line">pandas.merge可根据⼀个或多个键将不同DataFrame中的⾏连接起来。SQL或其他关系型数</span><br><span class="line">据库的⽤户对此应该会⽐较熟悉，因为它实现的就是数据库的join操作。</span><br><span class="line">pandas.concat可以沿着⼀条轴将多个对象堆叠到⼀起。</span><br><span class="line">实例⽅法combine_first可以将重复数据拼接在⼀起，⽤⼀个对象中的值填充另⼀个对象中的</span><br><span class="line">缺失值</span><br><span class="line">数据库⻛格的DataFrame合并</span><br><span class="line">数据集的合并（merge）或连接（join）运算是通过⼀个或多个键将⾏连接起来的</span><br><span class="line">In [35]: df1 = pd.DataFrame(&#123;&apos;key&apos;: [&apos;b&apos;, &apos;b&apos;, &apos;a&apos;, &apos;c&apos;, &apos;a&apos;, &apos;a&apos;, &apos;b&apos;],</span><br><span class="line"> ....: &apos;data1&apos;: range(7)&#125;)</span><br><span class="line">In [36]: df2 = pd.DataFrame(&#123;&apos;key&apos;: [&apos;a&apos;, &apos;b&apos;, &apos;d&apos;],</span><br><span class="line"> ....: &apos;data2&apos;: range(3)&#125;)</span><br><span class="line">In [37]: df1</span><br><span class="line">Out[37]:</span><br><span class="line"> data1 key</span><br><span class="line">0 0 b</span><br><span class="line">1 1 b</span><br><span class="line">2 2 a</span><br><span class="line">3 3 c</span><br><span class="line">4 4 a</span><br><span class="line">5 5 a</span><br><span class="line">6 6 b</span><br><span class="line">In [38]: df2</span><br><span class="line">Out[38]:</span><br><span class="line"> data2 key</span><br><span class="line">0 0 a</span><br><span class="line">1 1 b</span><br><span class="line">2 2 d</span><br><span class="line">这是⼀种多对⼀的合并</span><br><span class="line">In [39]: pd.merge(df1, df2)</span><br><span class="line">Out[39]:</span><br><span class="line"> data1 key data2</span><br><span class="line">0 0 b 1</span><br><span class="line">1 1 b 1</span><br><span class="line">2 6 b 1</span><br><span class="line">3 2 a 0</span><br><span class="line">4 4 a 0</span><br><span class="line">5 5 a 0</span><br><span class="line">没有指明要⽤哪个列进⾏连接。如果没有指定，merge就会将重叠列的列名当做键。最好明确</span><br><span class="line">指定⼀下</span><br><span class="line">In [40]: pd.merge(df1, df2, on=&apos;key&apos;)</span><br><span class="line">Out[40]:</span><br><span class="line"> data1 key data2</span><br><span class="line">0 0 b 1</span><br><span class="line">1 1 b 1</span><br><span class="line">2 6 b 1</span><br><span class="line">3 2 a 0</span><br><span class="line">4 4 a 0</span><br><span class="line">5 5 a 0</span><br><span class="line">如果两个对象的列名不同，也可以分别进⾏指定</span><br><span class="line">In [41]: df3 = pd.DataFrame(&#123;&apos;lkey&apos;: [&apos;b&apos;, &apos;b&apos;, &apos;a&apos;, &apos;c&apos;, &apos;a&apos;, &apos;a&apos;, &apos;b&apos;],</span><br><span class="line"> ....: &apos;data1&apos;: range(7)&#125;)</span><br><span class="line">In [42]: df4 = pd.DataFrame(&#123;&apos;rkey&apos;: [&apos;a&apos;, &apos;b&apos;, &apos;d&apos;],</span><br><span class="line"> ....: &apos;data2&apos;: range(3)&#125;)</span><br><span class="line">In [43]: pd.merge(df3, df4, left_on=&apos;lkey&apos;, right_on=&apos;rkey&apos;)</span><br><span class="line">Out[43]:</span><br><span class="line"> data1 lkey data2 rkey</span><br><span class="line">0 0 b 1 b</span><br><span class="line">1 1 b 1 b</span><br><span class="line">2 6 b 1 b</span><br><span class="line">3 2 a 0 a</span><br><span class="line">4 4 a 0 a</span><br><span class="line">5 5 a 0 a</span><br><span class="line">结果⾥⾯c和d以及与之相关的数据消失了。默认情况下，merge做的是“内连接”；结果中的键</span><br><span class="line">是交集。其他⽅式还有”left”、”right”以及”outer”。外连接求取的是键的并集，组合了左连接</span><br><span class="line">和右连接的效果</span><br><span class="line">In [44]: pd.merge(df1, df2, how=&apos;outer&apos;)</span><br><span class="line">Out[44]:</span><br><span class="line"> data1 key data2</span><br><span class="line">0 0.0 b 1.0</span><br><span class="line">1 1.0 b 1.0</span><br><span class="line">2 6.0 b 1.0</span><br><span class="line">3 2.0 a 0.0</span><br><span class="line">4 4.0 a 0.0</span><br><span class="line">5 5.0 a 0.0</span><br><span class="line">6 3.0 c NaN</span><br><span class="line">7 NaN d 2.0</span><br><span class="line">多对多的合并</span><br><span class="line">In [45]: df1 = pd.DataFrame(&#123;&apos;key&apos;: [&apos;b&apos;, &apos;b&apos;, &apos;a&apos;, &apos;c&apos;, &apos;a&apos;, &apos;b&apos;],</span><br><span class="line"> ....: &apos;data1&apos;: range(6)&#125;)</span><br><span class="line">In [46]: df2 = pd.DataFrame(&#123;&apos;key&apos;: [&apos;a&apos;, &apos;b&apos;, &apos;a&apos;, &apos;b&apos;, &apos;d&apos;],</span><br><span class="line"> ....: &apos;data2&apos;: range(5)&#125;)</span><br><span class="line">In [47]: df1</span><br><span class="line">Out[47]:</span><br><span class="line"> data1 key</span><br><span class="line">0 0 b</span><br><span class="line">1 1 b</span><br><span class="line">2 2 a</span><br><span class="line">3 3 c</span><br><span class="line">4 4 a</span><br><span class="line">5 5 b</span><br><span class="line">In [48]: df2</span><br><span class="line">Out[48]:</span><br><span class="line"> data2 key</span><br><span class="line">0 0 a</span><br><span class="line">1 1 b</span><br><span class="line">2 2 a</span><br><span class="line">3 3 b</span><br><span class="line">4 4 d</span><br><span class="line">In [49]: pd.merge(df1, df2, on=&apos;key&apos;, how=&apos;left&apos;)</span><br><span class="line">Out[49]:</span><br><span class="line"> data1 key data2</span><br><span class="line">0 0 b 1.0</span><br><span class="line">1 0 b 3.0</span><br><span class="line">2 1 b 1.0</span><br><span class="line">3 1 b 3.0</span><br><span class="line">4 2 a 0.0</span><br><span class="line">5 2 a 2.0</span><br><span class="line">6 3 c NaN</span><br><span class="line">7 4 a 0.0</span><br><span class="line">8 4 a 2.0</span><br><span class="line">9 5 b 1.0</span><br><span class="line">10 5 b 3.0</span><br><span class="line">多对多连接，由于左边的DataFrame有3个”b”⾏，右边的有2个，所以最终结果中就有6</span><br><span class="line">个”b”⾏</span><br><span class="line">In [50]: pd.merge(df1, df2, how=&apos;inner&apos;)</span><br><span class="line">Out[50]:</span><br><span class="line"> data1 key data2</span><br><span class="line">0 0 b 1</span><br><span class="line">1 0 b 3</span><br><span class="line">2 1 b 1</span><br><span class="line">3 1 b 3</span><br><span class="line">4 5 b 1</span><br><span class="line">5 5 b 3</span><br><span class="line">6 2 a 0</span><br><span class="line">7 2 a 2</span><br><span class="line">8 4 a 0</span><br><span class="line">9 4 a 2</span><br><span class="line">根据多个键进⾏合并</span><br><span class="line">In [51]: left = pd.DataFrame(&#123;&apos;key1&apos;: [&apos;foo&apos;, &apos;foo&apos;, &apos;bar&apos;],</span><br><span class="line"> ....: &apos;key2&apos;: [&apos;one&apos;, &apos;two&apos;, &apos;one&apos;],</span><br><span class="line"> ....: &apos;lval&apos;: [1, 2, 3]&#125;)</span><br><span class="line">In [52]: right = pd.DataFrame(&#123;&apos;key1&apos;: [&apos;foo&apos;, &apos;foo&apos;, &apos;bar&apos;, &apos;bar&apos;],</span><br><span class="line"> ....: &apos;key2&apos;: [&apos;one&apos;, &apos;one&apos;, &apos;one&apos;, &apos;two&apos;],</span><br><span class="line"> ....: &apos;rval&apos;: [4, 5, 6, 7]&#125;)</span><br><span class="line">In [53]: pd.merge(left, right, on=[&apos;key1&apos;, &apos;key2&apos;], how=&apos;outer&apos;)</span><br><span class="line">Out[53]:</span><br><span class="line"> key1 key2 lval rval</span><br><span class="line">0 foo one 1.0 4.0</span><br><span class="line">1 foo one 1.0 5.0</span><br><span class="line">2 foo two 2.0 NaN</span><br><span class="line">3 bar one 3.0 6.0</span><br><span class="line">4 bar two NaN 7.0</span><br><span class="line">重复列名的处理</span><br><span class="line">In [54]: pd.merge(left, right, on=&apos;key1&apos;)</span><br><span class="line">Out[54]:</span><br><span class="line"> key1 key2_x lval key2_y rval</span><br><span class="line">0 foo one 1 one 4</span><br><span class="line">1 foo one 1 one 5</span><br><span class="line">2 foo two 2 one 4</span><br><span class="line">3 foo two 2 one 5</span><br><span class="line">4 bar one 3 one 6</span><br><span class="line">5 bar one 3 two 7</span><br><span class="line">In [55]: pd.merge(left, right, on=&apos;key1&apos;, suffixes=(&apos;_left&apos;, &apos;_right&apos;))</span><br><span class="line">Out[55]:</span><br><span class="line"> key1 key2_left lval key2_right rval</span><br><span class="line">0 foo one 1 one 4</span><br><span class="line">1 foo one 1 one 5</span><br><span class="line">2 foo two 2 one 4</span><br><span class="line">3 foo two 2 one 5</span><br><span class="line">4 bar one 3 one 6</span><br><span class="line">5 bar one 3 two 7</span><br><span class="line">索引上的合并</span><br><span class="line">连接键位于其索引中。在这种情况下，你可以传⼊left_index=True或right_index=True（或两</span><br><span class="line">个都传）以说明索引应该被⽤作连接键</span><br><span class="line">In [56]: left1 = pd.DataFrame(&#123;&apos;key&apos;: [&apos;a&apos;, &apos;b&apos;, &apos;a&apos;, &apos;a&apos;, &apos;b&apos;, &apos;c&apos;],</span><br><span class="line"> ....: &apos;value&apos;: range(6)&#125;)</span><br><span class="line">In [57]: right1 = pd.DataFrame(&#123;&apos;group_val&apos;: [3.5, 7]&#125;, index=[&apos;a&apos;, &apos;b&apos;])</span><br><span class="line">In [58]: left1</span><br><span class="line">Out[58]:</span><br><span class="line"> key value</span><br><span class="line">0 a 0</span><br><span class="line">1 b 1</span><br><span class="line">2 a 2</span><br><span class="line">3 a 3</span><br><span class="line">4 b 4</span><br><span class="line">5 c 5</span><br><span class="line">In [59]: right1</span><br><span class="line">Out[59]:</span><br><span class="line"> group_val</span><br><span class="line">a 3.5</span><br><span class="line">b 7.0</span><br><span class="line">In [60]: pd.merge(left1, right1, left_on=&apos;key&apos;, right_index=True)</span><br><span class="line">Out[60]:</span><br><span class="line"> key value group_val</span><br><span class="line">0 a 0 3.5</span><br><span class="line">2 a 2 3.5</span><br><span class="line">3 a 3 3.5</span><br><span class="line">1 b 1 7.0</span><br><span class="line">4 b 4 7.0</span><br><span class="line">层次化索引的数据, 索引的合并默认是多键合并</span><br><span class="line">In [62]: lefth = pd.DataFrame(&#123;&apos;key1&apos;: [&apos;Ohio&apos;, &apos;Ohio&apos;, &apos;Ohio&apos;,</span><br><span class="line"> ....: &apos;Nevada&apos;, &apos;Nevada&apos;],</span><br><span class="line"> ....: &apos;key2&apos;: [2000, 2001, 2002, 2001, 2002],</span><br><span class="line"> ....: &apos;data&apos;: np.arange(5.)&#125;)</span><br><span class="line">In [63]: righth = pd.DataFrame(np.arange(12).reshape((6, 2)),</span><br><span class="line"> ....: index=[[&apos;Nevada&apos;, &apos;Nevada&apos;, &apos;Ohio&apos;, &apos;Ohio&apos;,</span><br><span class="line"> ....: &apos;Ohio&apos;, &apos;Ohio&apos;],</span><br><span class="line"> ....: [2001, 2000, 2000, 2000, 2001, 2002]],</span><br><span class="line"> ....: columns=[&apos;event1&apos;, &apos;event2&apos;])</span><br><span class="line">In [64]: lefth</span><br><span class="line">Out[64]:</span><br><span class="line"> data key1 key2</span><br><span class="line">0 0.0 Ohio 2000</span><br><span class="line">1 1.0 Ohio 2001</span><br><span class="line">2 2.0 Ohio 2002</span><br><span class="line">3 3.0 Nevada 2001</span><br><span class="line">4 4.0 Nevada 2002</span><br><span class="line">In [65]: righth</span><br><span class="line">Out[65]:</span><br><span class="line"> event1 event2</span><br><span class="line">Nevada 2001 0 1</span><br><span class="line"> 2000 2 3</span><br><span class="line">Ohio 2000 4 5</span><br><span class="line"> 2000 6 7</span><br><span class="line"> 2001 8 9</span><br><span class="line"> 2002 10 11</span><br><span class="line">必须以列表的形式指明⽤作合并键的多个列（注意⽤how=‘outer’对重复索引值的处理）</span><br><span class="line">In [66]: pd.merge(lefth, righth, left_on=[&apos;key1&apos;, &apos;key2&apos;], right_index=True)</span><br><span class="line">Out[66]:</span><br><span class="line"> data key1 key2 event1 event2</span><br><span class="line">0 0.0 Ohio 2000 4 5</span><br><span class="line">0 0.0 Ohio 2000 6 7</span><br><span class="line">1 1.0 Ohio 2001 8 9</span><br><span class="line">2 2.0 Ohio 2002 10 11</span><br><span class="line">3 3.0 Nevada 2001 0 1</span><br><span class="line">In [67]: pd.merge(lefth, righth, left_on=[&apos;key1&apos;, &apos;key2&apos;],</span><br><span class="line"> ....: right_index=True, how=&apos;outer&apos;)</span><br><span class="line">Out[67]:</span><br><span class="line"> data key1 key2 event1 event2</span><br><span class="line">0 0.0 Ohio 2000 4.0 5.0</span><br><span class="line">0 0.0 Ohio 2000 6.0 7.0</span><br><span class="line">1 1.0 Ohio 2001 8.0 9.0</span><br><span class="line">2 2.0 Ohio 2002 10.0 11.0</span><br><span class="line">3 3.0 Nevada 2001 0.0 1.0</span><br><span class="line">4 4.0 Nevada 2002 NaN NaN</span><br><span class="line">4 NaN Nevada 2000 2.0 3.0</span><br><span class="line">同时使⽤合并双⽅的索引</span><br><span class="line">In [68]: left2 = pd.DataFrame([[1., 2.], [3., 4.], [5., 6.]],</span><br><span class="line"> ....: index=[&apos;a&apos;, &apos;c&apos;, &apos;e&apos;],</span><br><span class="line"> ....: columns=[&apos;Ohio&apos;, &apos;Nevada&apos;])</span><br><span class="line">In [69]: right2 = pd.DataFrame([[7., 8.], [9., 10.], [11., 12.], [13, 14]],</span><br><span class="line"> ....: index=[&apos;b&apos;, &apos;c&apos;, &apos;d&apos;, &apos;e&apos;],</span><br><span class="line"> ....: columns=[&apos;Missouri&apos;, &apos;Alabama&apos;])</span><br><span class="line">In [70]: left2</span><br><span class="line">Out[70]:</span><br><span class="line"> Ohio Nevada</span><br><span class="line">a 1.0 2.0</span><br><span class="line">c 3.0 4.0</span><br><span class="line">e 5.0 6.0</span><br><span class="line">In [71]: right2</span><br><span class="line">Out[71]:</span><br><span class="line"> Missouri Alabama</span><br><span class="line">b 7.0 8.0</span><br><span class="line">c 9.0 10.0</span><br><span class="line">d 11.0 12.0</span><br><span class="line">e 13.0 14.0</span><br><span class="line">In [72]: pd.merge(left2, right2, how=&apos;outer&apos;, left_index=True,</span><br><span class="line">right_index=True)</span><br><span class="line">Out[72]:</span><br><span class="line"> Ohio Nevada Missouri Alabama</span><br><span class="line">a 1.0 2.0 NaN NaN</span><br><span class="line">b NaN NaN 7.0 8.0</span><br><span class="line">c 3.0 4.0 9.0 10.0</span><br><span class="line">d NaN NaN 11.0 12.0</span><br><span class="line">e 5.0 6.0 13.0 14.0</span><br><span class="line">join实例⽅法，能实现按索引合并</span><br><span class="line">In [73]: left2.join(right2, how=&apos;outer&apos;)</span><br><span class="line">Out[73]:</span><br><span class="line"> Ohio Nevada Missouri Alabama</span><br><span class="line">a 1.0 2.0 NaN NaN</span><br><span class="line">b NaN NaN 7.0 8.0</span><br><span class="line">c 3.0 4.0 9.0 10.0</span><br><span class="line">d NaN NaN 11.0 12.0</span><br><span class="line">e 5.0 6.0 13.0 14.0</span><br><span class="line">In [74]: left1.join(right1, on=&apos;key&apos;)</span><br><span class="line">Out[74]:</span><br><span class="line"> key value group_val</span><br><span class="line">0 a 0 3.5</span><br><span class="line">1 b 1 7.0</span><br><span class="line">2 a 2 3.5</span><br><span class="line">3 a 3 3.5</span><br><span class="line">4 b 4 7.0</span><br><span class="line">5 c 5 NaN</span><br><span class="line">向join传⼊⼀组DataFrame</span><br><span class="line">In [75]: another = pd.DataFrame([[7., 8.], [9., 10.], [11., 12.], [16., 17.]],</span><br><span class="line"> ....: index=[&apos;a&apos;, &apos;c&apos;, &apos;e&apos;, &apos;f&apos;],</span><br><span class="line"> ....: columns=[&apos;New York&apos;,</span><br><span class="line">&apos;Oregon&apos;])</span><br><span class="line">In [76]: another</span><br><span class="line">Out[76]:</span><br><span class="line"> New York Oregon</span><br><span class="line">a 7.0 8.0</span><br><span class="line">c 9.0 10.0</span><br><span class="line">e 11.0 12.0</span><br><span class="line">f 16.0 17.0</span><br><span class="line">In [77]: left2.join([right2, another])</span><br><span class="line">Out[77]:</span><br><span class="line"> Ohio Nevada Missouri Alabama New York Oregon</span><br><span class="line">a 1.0 2.0 NaN NaN 7.0 8.0</span><br><span class="line">c 3.0 4.0 9.0 10.0 9.0 10.0</span><br><span class="line">e 5.0 6.0 13.0 14.0 11.0 12.0</span><br><span class="line">In [78]: left2.join([right2, another], how=&apos;outer&apos;)</span><br><span class="line">Out[78]:</span><br><span class="line"> Ohio Nevada Missouri Alabama New York Oregon</span><br><span class="line">a 1.0 2.0 NaN NaN 7.0 8.0</span><br><span class="line">b NaN NaN 7.0 8.0 NaN NaN</span><br><span class="line">c 3.0 4.0 9.0 10.0 9.0 10.0</span><br><span class="line">d NaN NaN 11.0 12.0 NaN NaN</span><br><span class="line">e 5.0 6.0 13.0 14.0 11.0 12.0</span><br><span class="line">f NaN NaN NaN NaN 16.0 17.0</span><br><span class="line">轴向连接</span><br><span class="line">数据合并运算也被称作连接（concatenation）、绑定（binding）或堆叠（stacking）</span><br><span class="line">In [79]: arr = np.arange(12).reshape((3, 4))</span><br><span class="line">In [80]: arr</span><br><span class="line">Out[80]:</span><br><span class="line">array([[ 0, 1, 2, 3],</span><br><span class="line"> [ 4, 5, 6, 7],</span><br><span class="line"> [ 8, 9, 10, 11]])</span><br><span class="line">In [81]: np.concatenate([arr, arr], axis=1)</span><br><span class="line">Out[81]:</span><br><span class="line">array([[ 0, 1, 2, 3, 0, 1, 2, 3],</span><br><span class="line"> [ 4, 5, 6, 7, 4, 5, 6, 7],</span><br><span class="line"> [ 8, 9, 10, 11, 8, 9, 10, 11]])</span><br><span class="line">pandas的concat函数合并操作</span><br><span class="line">In [82]: s1 = pd.Series([0, 1], index=[&apos;a&apos;, &apos;b&apos;])</span><br><span class="line">In [83]: s2 = pd.Series([2, 3, 4], index=[&apos;c&apos;, &apos;d&apos;, &apos;e&apos;])</span><br><span class="line">In [84]: s3 = pd.Series([5, 6], index=[&apos;f&apos;, &apos;g&apos;])</span><br><span class="line">调⽤concat可以将值和索引粘合在⼀起</span><br><span class="line">In [85]: pd.concat([s1, s2, s3])</span><br><span class="line">Out[85]: </span><br><span class="line">a 0</span><br><span class="line">b 1</span><br><span class="line">c 2</span><br><span class="line">d 3</span><br><span class="line">e 4</span><br><span class="line">f 5</span><br><span class="line">g 6</span><br><span class="line">dtype: int64</span><br><span class="line">传⼊axis=1，则结果就会变成⼀个DataFrame（axis=1是列）</span><br><span class="line">In [86]: pd.concat([s1, s2, s3], axis=1)</span><br><span class="line">Out[86]:</span><br><span class="line"> 0 1 2</span><br><span class="line">a 0.0 NaN NaN</span><br><span class="line">b 1.0 NaN NaN</span><br><span class="line">c NaN 2.0 NaN</span><br><span class="line">d NaN 3.0 NaN</span><br><span class="line">e NaN 4.0 NaN</span><br><span class="line">f NaN NaN 5.0</span><br><span class="line">g NaN NaN 6.0</span><br><span class="line">In [87]: s4 = pd.concat([s1, s3])</span><br><span class="line">In [88]: s4</span><br><span class="line">Out[88]:</span><br><span class="line">a 0</span><br><span class="line">b 1</span><br><span class="line">f 5</span><br><span class="line">g 6</span><br><span class="line">dtype: int64</span><br><span class="line">In [89]: pd.concat([s1, s4], axis=1)</span><br><span class="line">Out[89]:</span><br><span class="line"> 0 1</span><br><span class="line">a 0.0 0</span><br><span class="line">b 1.0 1</span><br><span class="line">f NaN 5</span><br><span class="line">g NaN 6</span><br><span class="line">In [90]: pd.concat([s1, s4], axis=1, join=&apos;inner&apos;)</span><br><span class="line">Out[90]:</span><br><span class="line"> 0 1</span><br><span class="line">a 0 0</span><br><span class="line">b 1 1</span><br><span class="line">In [91]: pd.concat([s1, s4], axis=1, join_axes=[[&apos;a&apos;, &apos;c&apos;, &apos;b&apos;, &apos;e&apos;]])</span><br><span class="line">Out[91]:</span><br><span class="line"> 0 1</span><br><span class="line">a 0.0 0.0</span><br><span class="line">c NaN NaN</span><br><span class="line">b 1.0 1.0</span><br><span class="line">e NaN NaN</span><br><span class="line">参与连接的⽚段在结果中区分不开。假设你想要在连接轴上创建⼀个层次化索引。使⽤keys参</span><br><span class="line">数即可达到这个⽬的</span><br><span class="line">In [92]: result = pd.concat([s1, s1, s3], keys=[&apos;one&apos;,&apos;two&apos;, &apos;three&apos;])</span><br><span class="line">In [93]: result</span><br><span class="line">Out[93]:</span><br><span class="line">one a 0</span><br><span class="line"> b 1</span><br><span class="line">two a 0</span><br><span class="line"> b 1</span><br><span class="line">three f 5</span><br><span class="line"> g 6</span><br><span class="line">dtype: int64</span><br><span class="line">In [94]: result.unstack()</span><br><span class="line">Out[94]:</span><br><span class="line"> a b f g</span><br><span class="line">one 0.0 1.0 NaN NaN</span><br><span class="line">two 0.0 1.0 NaN NaN</span><br><span class="line">three NaN NaN 5.0 6.0</span><br><span class="line">如果沿着axis=1对Series进⾏合并，则keys就会成为DataFrame的列头</span><br><span class="line">In [95]: pd.concat([s1, s2, s3], axis=1, keys=[&apos;one&apos;,&apos;two&apos;, &apos;three&apos;])</span><br><span class="line">Out[95]:</span><br><span class="line"> one two three</span><br><span class="line">a 0.0 NaN NaN</span><br><span class="line">b 1.0 NaN NaN</span><br><span class="line">c NaN 2.0 NaN</span><br><span class="line">d NaN 3.0 NaN</span><br><span class="line">e NaN 4.0 NaN</span><br><span class="line">f NaN NaN 5.0</span><br><span class="line">g NaN NaN 6.0</span><br><span class="line">In [96]: df1 = pd.DataFrame(np.arange(6).reshape(3, 2), index=[&apos;a&apos;, &apos;b&apos;, &apos;c&apos;],</span><br><span class="line"> ....: columns=[&apos;one&apos;, &apos;two&apos;])</span><br><span class="line">In [97]: df2 = pd.DataFrame(5 + np.arange(4).reshape(2, 2), index=[&apos;a&apos;, &apos;c&apos;],</span><br><span class="line"> ....: columns=[&apos;three&apos;, &apos;four&apos;])</span><br><span class="line">In [98]: df1</span><br><span class="line">Out[98]:</span><br><span class="line"> one two</span><br><span class="line">a 0 1</span><br><span class="line">b 2 3</span><br><span class="line">c 4 5</span><br><span class="line">In [99]: df2</span><br><span class="line">Out[99]:</span><br><span class="line"> three four</span><br><span class="line">a 5 6</span><br><span class="line">c 7 8</span><br><span class="line">In [100]: pd.concat([df1, df2], axis=1, keys=[&apos;level1&apos;, &apos;level2&apos;])</span><br><span class="line">Out[100]:</span><br><span class="line"> level1 level2</span><br><span class="line"> one two three four</span><br><span class="line">a 0 1 5.0 6.0</span><br><span class="line">b 2 3 NaN NaN</span><br><span class="line">c 4 5 7.0 8.0</span><br><span class="line">In [101]: pd.concat(&#123;&apos;level1&apos;: df1, &apos;level2&apos;: df2&#125;, axis=1)</span><br><span class="line">Out[101]:</span><br><span class="line"> level1 level2</span><br><span class="line"> one two three four</span><br><span class="line">a 0 1 5.0 6.0</span><br><span class="line">b 2 3 NaN NaN</span><br><span class="line">c 4 5 7.0 8.0</span><br><span class="line">⽤names参数命名创建的轴级别</span><br><span class="line">In [102]: pd.concat([df1, df2], axis=1, keys=[&apos;level1&apos;, &apos;level2&apos;],</span><br><span class="line"> .....: names=[&apos;upper&apos;, &apos;lower&apos;])</span><br><span class="line">Out[102]:</span><br><span class="line">upper level1 level2</span><br><span class="line">lower one two three four</span><br><span class="line">a 0 1 5.0 6.0</span><br><span class="line">b 2 3 NaN NaN</span><br><span class="line">c 4 5 7.0 8.0</span><br><span class="line">DataFrame的⾏索引不包含任何相关数据, 传⼊ignore_index=True</span><br><span class="line">In [103]: df1 = pd.DataFrame(np.random.randn(3, 4), columns=[&apos;a&apos;, &apos;b&apos;, &apos;c&apos;,</span><br><span class="line">&apos;d&apos;])</span><br><span class="line">In [104]: df2 = pd.DataFrame(np.random.randn(2, 3), columns=[&apos;b&apos;, &apos;d&apos;, &apos;a&apos;])</span><br><span class="line">In [105]: df1</span><br><span class="line">Out[105]:</span><br><span class="line"> a b c d</span><br><span class="line">0 1.246435 1.007189 -1.296221 0.274992</span><br><span class="line">1 0.228913 1.352917 0.886429 -2.001637</span><br><span class="line">2 -0.371843 1.669025 -0.438570 -0.539741</span><br><span class="line">In [106]: df2</span><br><span class="line">Out[106]:</span><br><span class="line"> b d a</span><br><span class="line">0 0.476985 3.248944 -1.021228</span><br><span class="line">1 -0.577087 0.124121 0.302614</span><br><span class="line">In [107]: pd.concat([df1, df2], ignore_index=True)</span><br><span class="line">Out[107]:</span><br><span class="line"> a b c d</span><br><span class="line">0 1.246435 1.007189 -1.296221 0.274992</span><br><span class="line">1 0.228913 1.352917 0.886429 -2.001637</span><br><span class="line">2 -0.371843 1.669025 -0.438570 -0.539741</span><br><span class="line">3 -1.021228 0.476985 NaN 3.248944</span><br><span class="line">4 0.302614 -0.577087 NaN 0.124121</span><br><span class="line">合并重叠数据</span><br><span class="line">索引全部或部分重叠的两个数据集</span><br><span class="line">In [108]: a = pd.Series([np.nan, 2.5, np.nan, 3.5, 4.5, np.nan],</span><br><span class="line"> .....: index=[&apos;f&apos;, &apos;e&apos;, &apos;d&apos;, &apos;c&apos;, &apos;b&apos;, &apos;a&apos;])</span><br><span class="line">In [109]: b = pd.Series(np.arange(len(a), dtype=np.float64),</span><br><span class="line"> .....: index=[&apos;f&apos;, &apos;e&apos;, &apos;d&apos;, &apos;c&apos;, &apos;b&apos;, &apos;a&apos;])</span><br><span class="line">In [110]: b[-1] = np.nan</span><br><span class="line">In [111]: a</span><br><span class="line">Out[111]: </span><br><span class="line">f NaN</span><br><span class="line">e 2.5</span><br><span class="line">d NaN</span><br><span class="line">c 3.5</span><br><span class="line">b 4.5</span><br><span class="line">a NaN</span><br><span class="line">dtype: float64</span><br><span class="line">In [112]: b</span><br><span class="line">Out[112]:</span><br><span class="line">f 0.0</span><br><span class="line">e 1.0</span><br><span class="line">d 2.0</span><br><span class="line">c 3.0</span><br><span class="line">b 4.0</span><br><span class="line">a NaN</span><br><span class="line">dtype: float64</span><br><span class="line">In [113]: np.where(pd.isnull(a), b, a)</span><br><span class="line">Out[113]: array([ 0. , 2.5, 2. , 3.5, 4.5, nan])</span><br><span class="line">此语句实现⼀样的功能</span><br><span class="line">In [114]: b[:-2].combine_first(a[2:])</span><br><span class="line">Out[114]:</span><br><span class="line">a NaN</span><br><span class="line">b 4.5</span><br><span class="line">c 3.0</span><br><span class="line">d 2.0</span><br><span class="line">e 1.0</span><br><span class="line">f 0.0</span><br><span class="line">dtype: float64</span><br><span class="line">对于DataFrame，combine_first⾃然也会在列上做同样的事情，因此你可以将其看做：⽤传</span><br><span class="line">递对象中的数据为调⽤对象的缺失数据“打补丁”</span><br><span class="line">In [115]: df1 = pd.DataFrame(&#123;&apos;a&apos;: [1., np.nan, 5., np.nan],</span><br><span class="line"> .....: &apos;b&apos;: [np.nan, 2., np.nan, 6.],</span><br><span class="line"> .....: &apos;c&apos;: range(2, 18, 4)&#125;)</span><br><span class="line">In [116]: df2 = pd.DataFrame(&#123;&apos;a&apos;: [5., 4., np.nan, 3., 7.],</span><br><span class="line"> .....: &apos;b&apos;: [np.nan, 3., 4., 6., 8.]&#125;)</span><br><span class="line">In [117]: df1</span><br><span class="line">Out[117]:</span><br><span class="line"> a b c</span><br><span class="line">0 1.0 NaN 2</span><br><span class="line">1 NaN 2.0 6</span><br><span class="line">2 5.0 NaN 10</span><br><span class="line">3 NaN 6.0 14</span><br><span class="line">In [118]: df2</span><br><span class="line">Out[118]:</span><br><span class="line"> a b</span><br><span class="line">0 5.0 NaN</span><br><span class="line">1 4.0 3.0</span><br><span class="line">2 NaN 4.0</span><br><span class="line">3 3.0 6.0</span><br><span class="line">4 7.0 8.0</span><br><span class="line">In [119]: df1.combine_first(df2)</span><br><span class="line">Out[119]:</span><br><span class="line"> a b c</span><br><span class="line">0 1.0 NaN 2.0</span><br><span class="line">1 4.0 2.0 6.0</span><br><span class="line">2 5.0 4.0 10.0</span><br><span class="line">3 3.0 6.0 14.0</span><br><span class="line">4 7.0 8.0 NaN</span><br><span class="line">重塑和轴向旋转</span><br><span class="line">⽤于重新排列表格型数据的基础运算。这些函数也称作重塑（reshape）或轴向旋转（pivot）</span><br><span class="line">运算</span><br><span class="line">重塑层次化索引</span><br><span class="line">stack：将数据的列“旋转”为⾏</span><br><span class="line">unstack：将数据的⾏“旋转”为列</span><br><span class="line">In [120]: data = pd.DataFrame(np.arange(6).reshape((2, 3)),</span><br><span class="line"> .....: index=pd.Index([&apos;Ohio&apos;,&apos;Colorado&apos;],</span><br><span class="line">name=&apos;state&apos;),</span><br><span class="line"> .....: columns=pd.Index([&apos;one&apos;, &apos;two&apos;, &apos;three&apos;],</span><br><span class="line"> .....: name=&apos;number&apos;))</span><br><span class="line">In [121]: data</span><br><span class="line">Out[121]:</span><br><span class="line">number one two three</span><br><span class="line">state</span><br><span class="line">Ohio 0 1 2</span><br><span class="line">Colorado 3 4 5</span><br><span class="line">对该数据使⽤stack⽅法即可将列转换为⾏，得到⼀个Series</span><br><span class="line">In [122]: result = data.stack()</span><br><span class="line">In [123]: result</span><br><span class="line">Out[123]:</span><br><span class="line">state number</span><br><span class="line">Ohio one 0</span><br><span class="line"> two 1</span><br><span class="line"> three 2</span><br><span class="line">Colorado one 3</span><br><span class="line"> two 4</span><br><span class="line"> three 5</span><br><span class="line">dtype: int64</span><br><span class="line">对于⼀个层次化索引的Series，你可以⽤unstack将其重排为⼀个DataFrame：</span><br><span class="line">In [124]: result.unstack()</span><br><span class="line">Out[124]:</span><br><span class="line">number one two three</span><br><span class="line">state</span><br><span class="line">Ohio 0 1 2</span><br><span class="line">Colorado 3 4 5</span><br><span class="line">默认情况下，unstack操作的是最内层（stack也是如此）。传⼊分层级别的编号或名称即可对</span><br><span class="line">其它级别进⾏unstack操作</span><br><span class="line">In [125]: result.unstack(0)</span><br><span class="line">Out[125]:</span><br><span class="line">state Ohio Colorado</span><br><span class="line">number</span><br><span class="line">one 0 3</span><br><span class="line">two 1 4</span><br><span class="line">three 2 5</span><br><span class="line">In [126]: result.unstack(&apos;state&apos;)</span><br><span class="line">Out[126]:</span><br><span class="line">state Ohio Colorado</span><br><span class="line">number</span><br><span class="line">one 0 3</span><br><span class="line">two 1 4</span><br><span class="line">three 2 5</span><br><span class="line">将“⻓格式”旋转为“宽格式”</span><br><span class="line">多个时间序列数据通常是以所谓的“⻓格式”（long）或“堆叠格式”（stacked）存储在数据库和</span><br><span class="line">CSV中的。我们先加载⼀些示例数据，做⼀些时间序列规整和数据清洗</span><br><span class="line">In [139]: data = pd.read_csv(&apos;examples/macrodata.csv&apos;)</span><br><span class="line">In [140]: data.head()</span><br><span class="line">Out[140]:</span><br><span class="line"> year quarter realgdp realcons realinv realgovt realdpi cpi \</span><br><span class="line">0 1959.0 1.0 2710.349 1707.4 286.898 470.045 1886.9 28.98</span><br><span class="line">1 1959.0 2.0 2778.801 1733.7 310.859 481.301 1919.7 29.15</span><br><span class="line">2 1959.0 3.0 2775.488 1751.8 289.226 491.260 1916.4 29.35 </span><br><span class="line">3 1959.0 4.0 2785.204 1753.7 299.356 484.052 1931.3 29.37</span><br><span class="line">4 1960.0 1.0 2847.699 1770.5 331.722 462.199 1955.5 29.54</span><br><span class="line"> m1 tbilrate unemp pop infl realint</span><br><span class="line">0 139.7 2.82 5.8 177.146 0.00 0.00</span><br><span class="line">1 141.7 3.08 5.1 177.830 2.34 0.74</span><br><span class="line">2 140.5 3.82 5.3 178.657 2.74 1.09</span><br><span class="line">3 140.0 4.33 5.6 179.386 0.27 4.06</span><br><span class="line">4 139.6 3.50 5.2 180.007 2.31 1.19</span><br><span class="line">In [141]: periods = pd.PeriodIndex(year=data.year, quarter=data.quarter,</span><br><span class="line"> .....: name=&apos;date&apos;)</span><br><span class="line">In [142]: columns = pd.Index([&apos;realgdp&apos;, &apos;infl&apos;, &apos;unemp&apos;], name=&apos;item&apos;)</span><br><span class="line">In [143]: data = data.reindex(columns=columns)</span><br><span class="line">In [144]: data.index = periods.to_timestamp(&apos;D&apos;, &apos;end&apos;)</span><br><span class="line">In [145]: ldata = data.stack().reset_index().rename(columns=&#123;0: &apos;value&apos;&#125;)</span><br><span class="line">不同的item值分别形成⼀列，date列中的时间戳则⽤作索引</span><br><span class="line"># 前两个传递的值分别⽤作⾏和列索引，最后⼀个可选值则是⽤于填充DataFrame的数据列</span><br><span class="line">In [147]: pivoted = ldata.pivot(&apos;date&apos;, &apos;item&apos;, &apos;value&apos;)</span><br><span class="line">In [148]: pivoted</span><br><span class="line">Out[148]:</span><br><span class="line">item infl realgdp unemp</span><br><span class="line">date</span><br><span class="line">1959-03-31 0.00 2710.349 5.8</span><br><span class="line">1959-06-30 2.34 2778.801 5.1</span><br><span class="line">1959-09-30 2.74 2775.488 5.3</span><br><span class="line">1959-12-31 0.27 2785.204 5.6</span><br><span class="line">1960-03-31 2.31 2847.699 5.2</span><br><span class="line">1960-06-30 0.14 2834.390 5.2</span><br><span class="line">1960-09-30 2.70 2839.022 5.6</span><br><span class="line">1960-12-31 1.21 2802.616 6.3</span><br><span class="line">1961-03-31 -0.40 2819.264 6.8</span><br><span class="line">1961-06-30 1.47 2872.005 7.0</span><br><span class="line">... ... ... ...</span><br><span class="line">2007-06-30 2.75 13203.977 4.5</span><br><span class="line">2007-09-30 3.45 13321.109 4.7</span><br><span class="line">2007-12-31 6.38 13391.249 4.8</span><br><span class="line">2008-03-31 2.82 13366.865 4.9</span><br><span class="line">2008-06-30 8.53 13415.266 5.4</span><br><span class="line">2008-09-30 -3.16 13324.600 6.0</span><br><span class="line">2008-12-31 -8.79 13141.920 6.9</span><br><span class="line">2009-03-31 0.94 12925.410 8.1</span><br><span class="line">2009-06-30 3.37 12901.504 9.2</span><br><span class="line">2009-09-30 3.56 12990.341 9.6</span><br><span class="line">[203 rows x 3 columns]</span><br><span class="line">In [149]: ldata[&apos;value2&apos;] = np.random.randn(len(ldata))</span><br><span class="line">In [150]: ldata[:10]</span><br><span class="line">Out[150]:</span><br><span class="line"> date item value value2</span><br><span class="line">0 1959-03-31 realgdp 2710.349 0.523772</span><br><span class="line">1 1959-03-31 infl 0.000 0.000940</span><br><span class="line">2 1959-03-31 unemp 5.800 1.343810</span><br><span class="line">3 1959-06-30 realgdp 2778.801 -0.713544</span><br><span class="line">4 1959-06-30 infl 2.340 -0.831154</span><br><span class="line">5 1959-06-30 unemp 5.100 -2.370232</span><br><span class="line">6 1959-09-30 realgdp 2775.488 -1.860761</span><br><span class="line">7 1959-09-30 infl 2.740 -0.860757</span><br><span class="line">8 1959-09-30 unemp 5.300 0.560145</span><br><span class="line">9 1959-12-31 realgdp 2785.204 -1.265934</span><br><span class="line">如果忽略最后⼀个参数，得到的DataFrame就会带有层次化的列</span><br><span class="line">In [151]: pivoted = ldata.pivot(&apos;date&apos;, &apos;item&apos;)</span><br><span class="line">In [152]: pivoted[:5]</span><br><span class="line">Out[152]:</span><br><span class="line"> value value2</span><br><span class="line">item infl realgdp unemp infl realgdp unemp</span><br><span class="line">date</span><br><span class="line">1959-03-31 0.00 2710.349 5.8 0.000940 0.523772 1.343810</span><br><span class="line">1959-06-30 2.34 2778.801 5.1 -0.831154 -0.713544 -2.370232</span><br><span class="line">1959-09-30 2.74 2775.488 5.3 -0.860757 -1.860761 0.560145</span><br><span class="line">1959-12-31 0.27 2785.204 5.6 0.119827 -1.265934 -1.063512</span><br><span class="line">1960-03-31 2.31 2847.699 5.2 -2.359419 0.332883 -0.199543</span><br><span class="line">In [153]: pivoted[&apos;value&apos;][:5]</span><br><span class="line">Out[153]:</span><br><span class="line">item infl realgdp unemp</span><br><span class="line">date</span><br><span class="line">1959-03-31 0.00 2710.349 5.8</span><br><span class="line">1959-06-30 2.34 2778.801 5.1</span><br><span class="line">1959-09-30 2.74 2775.488 5.3</span><br><span class="line">1959-12-31 0.27 2785.204 5.6</span><br><span class="line">1960-03-31 2.31 2847.699 5.2</span><br><span class="line">将“宽格式”旋转为“⻓格式”</span><br><span class="line">In [157]: df = pd.DataFrame(&#123;&apos;key&apos;: [&apos;foo&apos;, &apos;bar&apos;, &apos;baz&apos;],</span><br><span class="line"> .....: &apos;A&apos;: [1, 2, 3],</span><br><span class="line"> .....: &apos;B&apos;: [4, 5, 6],</span><br><span class="line"> .....: &apos;C&apos;: [7, 8, 9]&#125;)</span><br><span class="line">In [158]: df</span><br><span class="line">Out[158]:</span><br><span class="line"> A B C key</span><br><span class="line">0 1 4 7 foo</span><br><span class="line">1 2 5 8 bar</span><br><span class="line">2 3 6 9 baz</span><br><span class="line">当使⽤pandas.melt，我们必须指明哪些列是分组指标。下⾯使⽤key作为唯⼀的分组指标</span><br><span class="line">In [159]: melted = pd.melt(df, [&apos;key&apos;])</span><br><span class="line">In [160]: melted</span><br><span class="line">Out[160]:</span><br><span class="line"> key variable value</span><br><span class="line">0 foo A 1</span><br><span class="line">1 bar A 2</span><br><span class="line">2 baz A 3</span><br><span class="line">3 foo B 4</span><br><span class="line">4 bar B 5</span><br><span class="line">5 baz B 6</span><br><span class="line">6 foo C 7</span><br><span class="line">7 bar C 8</span><br><span class="line">8 baz C 9</span><br><span class="line">使⽤pivot，可以重塑回原来的样⼦</span><br><span class="line">In [161]: reshaped = melted.pivot(&apos;key&apos;, &apos;variable&apos;, &apos;value&apos;)</span><br><span class="line">In [162]: reshaped</span><br><span class="line">Out[162]:</span><br><span class="line">variable A B C</span><br><span class="line">key</span><br><span class="line">bar 2 5 8</span><br><span class="line">baz 3 6 9</span><br><span class="line">foo 1 4 7</span><br><span class="line">因为pivot的结果从列创建了⼀个索引，⽤作⾏标签，我们可以使⽤reset_index将数据移回列</span><br><span class="line">In [163]: reshaped.reset_index()</span><br><span class="line">Out[163]:</span><br><span class="line">variable key A B C</span><br><span class="line">0 bar 2 5 8</span><br><span class="line">1 baz 3 6 9</span><br><span class="line">2 foo 1 4 7</span><br><span class="line">指定列的⼦集，作为值的列</span><br><span class="line">In [164]: pd.melt(df, id_vars=[&apos;key&apos;], value_vars=[&apos;A&apos;, &apos;B&apos;])</span><br><span class="line">Out[164]:</span><br><span class="line"> key variable value</span><br><span class="line">0 foo A 1</span><br><span class="line">1 bar A 2</span><br><span class="line">2 baz A 3</span><br><span class="line">3 foo B 4</span><br><span class="line">4 bar B 5</span><br><span class="line">5 baz B 6</span><br><span class="line">pandas.melt也可以不⽤分组指标</span><br><span class="line">In [165]: pd.melt(df, value_vars=[&apos;A&apos;, &apos;B&apos;, &apos;C&apos;])</span><br><span class="line">Out[165]:</span><br><span class="line"> variable value</span><br><span class="line">0 A 1</span><br><span class="line">1 A 2</span><br><span class="line">2 A 3</span><br><span class="line">3 B 4</span><br><span class="line">4 B 5</span><br><span class="line">5 B 6</span><br><span class="line">6 C 7</span><br><span class="line">7 C 8</span><br><span class="line">8 C 9</span><br><span class="line">In [166]: pd.melt(df, value_vars=[&apos;key&apos;, &apos;A&apos;, &apos;B&apos;])</span><br><span class="line">Out[166]:</span><br><span class="line"> variable value</span><br><span class="line">0 key foo</span><br><span class="line">1 key bar</span><br><span class="line">2 key baz</span><br><span class="line">3 A 1</span><br><span class="line">4 A 2</span><br><span class="line">5 A 3</span><br><span class="line">6 B 4</span><br><span class="line">7 B 5</span><br><span class="line">8 B 6</span><br></pre></td></tr></table></figure>
<h3 id="将文件里的信息上传到数据库"><a href="#将文件里的信息上传到数据库" class="headerlink" title="将文件里的信息上传到数据库"></a>将文件里的信息上传到数据库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">mysql --local-infile=1 -u root -p</span><br><span class="line"></span><br><span class="line">create table ratings (</span><br><span class="line">	user_id int null,</span><br><span class="line">	movie_id int null,</span><br><span class="line">	ratings int null,</span><br><span class="line">	rating_time int null</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">-- 指定导入文件的位置 </span><br><span class="line">LOAD DATA local INFILE &apos;F:\\datasets\\movielens\\ratings.dat&apos; </span><br><span class="line">-- 导入到哪张表</span><br><span class="line">INTO TABLE ratings </span><br><span class="line">-- 字段分隔符用什么</span><br><span class="line">FIELDS TERMINATED BY &apos;::&apos;  </span><br><span class="line">-- 双引号是括住字段</span><br><span class="line">ENCLOSED BY &apos;&quot;&apos; </span><br><span class="line">-- 你用什么符号来区别换行</span><br><span class="line">LINES TERMINATED BY &apos;\n&apos;;</span><br><span class="line"></span><br><span class="line">create table movies (</span><br><span class="line">	movie_id int null,</span><br><span class="line">	title varchar(256) null,</span><br><span class="line">	genres varchar(512) null</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">LOAD DATA local INFILE &apos;F:\\datasets\\movielens\\movies.dat&apos; </span><br><span class="line">INTO TABLE movies FIELDS TERMINATED BY &apos;::&apos;  ENCLOSED BY &apos;&quot;&apos; LINES TERMINATED BY &apos;\n&apos;;</span><br><span class="line"></span><br><span class="line">create table users (</span><br><span class="line">	user_id int null,</span><br><span class="line">	gender varchar(2) null,</span><br><span class="line">	age int null,</span><br><span class="line">	occupation int null,</span><br><span class="line">	zip_code varchar(128) null</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">LOAD DATA local INFILE &apos;F:\\datasets\\movielens\\users.dat&apos; </span><br><span class="line">INTO TABLE users FIELDS TERMINATED BY &apos;::&apos;  ENCLOSED BY &apos;&quot;&apos; LINES TERMINATED BY &apos;\n&apos;;</span><br><span class="line"></span><br><span class="line">	*  1:  &quot;Under 18&quot;   &lt; 18</span><br><span class="line">	* 18:  &quot;18-24&quot;   18 &lt;= &lt; 25</span><br><span class="line">	* 25:  &quot;25-34&quot;   25 &lt;= &lt; 35</span><br><span class="line">	* 35:  &quot;35-44&quot;   35 &lt;= &lt; 45</span><br><span class="line">	* 45:  &quot;45-49&quot;   45 &lt;= &lt;50</span><br><span class="line">	* 50:  &quot;50-55&quot;   50 &lt;= &lt; 56</span><br><span class="line">	* 56:  &quot;56+&quot;     56 &lt;=</span><br><span class="line"></span><br><span class="line">create table age_dict (</span><br><span class="line">	age_id int null,</span><br><span class="line">	age_min int null,</span><br><span class="line">	age_max int null</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">insert into age_dict (age_id, age_min, age_max) values(1, 0, 18);</span><br><span class="line">insert into age_dict (age_id, age_min, age_max) values(18, 18, 25);</span><br><span class="line">insert into age_dict (age_id, age_min, age_max) values(25, 25, 35);</span><br><span class="line">insert into age_dict (age_id, age_min, age_max) values(35, 35, 45);</span><br><span class="line">insert into age_dict (age_id, age_min, age_max) values(45, 45, 50);</span><br><span class="line">insert into age_dict (age_id, age_min, age_max) values(50, 50, 56);</span><br><span class="line">insert into age_dict (age_id, age_min, age_max) values(56, 56, 300);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- Occupation is chosen from the following choices:</span><br><span class="line"></span><br><span class="line">	*  0:  &quot;other&quot; or not specified</span><br><span class="line">	*  1:  &quot;academic/educator&quot;</span><br><span class="line">	*  2:  &quot;artist&quot;</span><br><span class="line">	*  3:  &quot;clerical/admin&quot;</span><br><span class="line">	*  4:  &quot;college/grad student&quot;</span><br><span class="line">	*  5:  &quot;customer service&quot;</span><br><span class="line">	*  6:  &quot;doctor/health care&quot;</span><br><span class="line">	*  7:  &quot;executive/managerial&quot;</span><br><span class="line">	*  8:  &quot;farmer&quot;</span><br><span class="line">	*  9:  &quot;homemaker&quot;</span><br><span class="line">	* 10:  &quot;K-12 student&quot;</span><br><span class="line">	* 11:  &quot;lawyer&quot;</span><br><span class="line">	* 12:  &quot;programmer&quot;</span><br><span class="line">	* 13:  &quot;retired&quot;</span><br><span class="line">	* 14:  &quot;sales/marketing&quot;</span><br><span class="line">	* 15:  &quot;scientist&quot;</span><br><span class="line">	* 16:  &quot;self-employed&quot;</span><br><span class="line">	* 17:  &quot;technician/engineer&quot;</span><br><span class="line">	* 18:  &quot;tradesman/craftsman&quot;</span><br><span class="line">	* 19:  &quot;unemployed&quot;</span><br><span class="line">	* 20:  &quot;writer&quot;</span><br><span class="line"></span><br><span class="line">create table occup_dict (</span><br><span class="line">	occup_id int null,</span><br><span class="line">	occup_title varchar(256) null</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">insert into occup_dict (occup_id, occup_title) values(0, &apos;other or not specified&apos;);</span><br><span class="line">insert into occup_dict (occup_id, occup_title) values(1, &apos;academic/educator&apos;);</span><br><span class="line">insert into occup_dict (occup_id, occup_title) values(2, &apos;artist&apos;);</span><br><span class="line">insert into occup_dict (occup_id, occup_title) values(3, &apos;clerical/admin&apos;);</span><br><span class="line">insert into occup_dict (occup_id, occup_title) values(4, &apos;college/grad student&apos;);</span><br><span class="line">insert into occup_dict (occup_id, occup_title) values(5, &apos;customer service&apos;);</span><br><span class="line">insert into occup_dict (occup_id, occup_title) values(6, &apos;doctor/health care&apos;);</span><br><span class="line">insert into occup_dict (occup_id, occup_title) values(7, &apos;executive/managerial&apos;);</span><br><span class="line">insert into occup_dict (occup_id, occup_title) values(8, &apos;farmer&apos;);</span><br><span class="line">insert into occup_dict (occup_id, occup_title) values(9, &apos;homemaker&apos;);</span><br><span class="line">insert into occup_dict (occup_id, occup_title) values(10, &apos;K-12 student&apos;);</span><br><span class="line">insert into occup_dict (occup_id, occup_title) values(11, &apos;lawyer&apos;);</span><br><span class="line">insert into occup_dict (occup_id, occup_title) values(12, &apos;programmer&apos;);</span><br><span class="line">insert into occup_dict (occup_id, occup_title) values(13, &apos;retired&apos;);</span><br><span class="line">insert into occup_dict (occup_id, occup_title) values(14, &apos;sales/marketing&apos;);</span><br><span class="line">insert into occup_dict (occup_id, occup_title) values(15, &apos;scientist&apos;);</span><br><span class="line">insert into occup_dict (occup_id, occup_title) values(16, &apos;self-employed&apos;);</span><br><span class="line">insert into occup_dict (occup_id, occup_title) values(17, &apos;technician/engineer&apos;);</span><br><span class="line">insert into occup_dict (occup_id, occup_title) values(18, &apos;tradesman/craftsman&apos;);</span><br><span class="line">insert into occup_dict (occup_id, occup_title) values(19, &apos;unemployed&apos;);</span><br><span class="line">insert into occup_dict (occup_id, occup_title) values(20, &apos;writer&apos;);</span><br></pre></td></tr></table></figure>
<h3 id="查询数据库里的信息"><a href="#查询数据库里的信息" class="headerlink" title="查询数据库里的信息"></a>查询数据库里的信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">找出用户的性别、年龄、电影名、打分</span><br><span class="line"></span><br><span class="line">select gender, age_dict.age_min, age_dict.age_max, title, ratings</span><br><span class="line">from users, movies, ratings, age_dict</span><br><span class="line">where users.user_id = ratings.user_id and </span><br><span class="line">ratings.movie_id = movies.movie_id and </span><br><span class="line">age_dict.age_id = users.age;</span><br><span class="line"></span><br><span class="line">select a.gender, d.age_min, d.age_max, c.title, b.ratings</span><br><span class="line">from users a inner join ratings b</span><br><span class="line">on a.user_id = b.user_id</span><br><span class="line">inner join movies c</span><br><span class="line">on b.movie_id = c.movie_id</span><br><span class="line">inner join age_dict d</span><br><span class="line">on a.age = d.age_id;</span><br><span class="line"></span><br><span class="line">查找不同性别的平均打分</span><br><span class="line">select case when a.gender = &apos;F&apos; then &apos;女&apos; else &apos;男&apos; end as 性别, </span><br><span class="line">avg(b.ratings) as 平均打分</span><br><span class="line">from users a inner join ratings b</span><br><span class="line">on a.user_id = b.user_id</span><br><span class="line">group by a.gender;</span><br><span class="line"></span><br><span class="line">查询电影名的平均打分</span><br><span class="line">select a.title, avg(b.ratings)</span><br><span class="line">from movies a inner join ratings b</span><br><span class="line">on a.movie_id = b.movie_id</span><br><span class="line">group by a.title;</span><br><span class="line"></span><br><span class="line">查询不同性别对电影的平均打分</span><br><span class="line"></span><br><span class="line">select a.gender, c.title, avg(b.ratings)</span><br><span class="line">from users a inner join ratings b</span><br><span class="line">on a.user_id = b.user_id</span><br><span class="line">inner join movies c</span><br><span class="line">on c.movie_id = b.movie_id</span><br><span class="line">group by a.gender, c.title</span><br><span class="line">order by c.title </span><br><span class="line">limit 3;</span><br><span class="line"></span><br><span class="line">查询不同年龄段的电影平均评分，不分性别</span><br><span class="line"></span><br><span class="line">set @rownum=0;</span><br><span class="line"></span><br><span class="line">create table temp_result as</span><br><span class="line">select @rownum:=@rownum+1 as rownum, CONCAT(c.age_min,&apos;～&apos;,c.age_max) as 年龄段, d.title, avg(b.ratings) as 平均评分</span><br><span class="line">from users a inner join ratings b </span><br><span class="line">on a.user_id = b.user_id</span><br><span class="line">inner join age_dict c</span><br><span class="line">on a.age = c.age_id</span><br><span class="line">inner join movies d</span><br><span class="line">on d.movie_id = b.movie_id</span><br><span class="line">group by c.age_min, c.age_max, d.title;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">不同职业的电影平均得分，要分性别</span><br><span class="line">select c.occup_title, a.gender, avg(b.ratings)</span><br><span class="line">from users a inner join ratings b</span><br><span class="line">on a.user_id = b.user_id</span><br><span class="line">inner join occup_dict c</span><br><span class="line">on a.occupation = c.occup_id</span><br><span class="line">group by c.occup_title, a.gender;</span><br><span class="line"></span><br><span class="line">各个年龄段最喜欢的电影</span><br><span class="line">select d.age_min, d.age_max, c.title, b.ratings</span><br><span class="line">from users a inner join ratings b</span><br><span class="line">on a.user_id = b.user_id</span><br><span class="line">inner join movies c</span><br><span class="line">on c.movie_id = b.movie_id</span><br><span class="line">inner join age_dict d</span><br><span class="line">on d.age_id = a.age</span><br><span class="line">group by d.age_min, d.age_max</span><br><span class="line">order by b.ratings desc</span><br><span class="line">limit 0,1;</span><br><span class="line"></span><br><span class="line">select a.gender, c.title, avg(b.ratings)</span><br><span class="line">from users a inner join ratings b</span><br><span class="line">on a.user_id = b.user_id</span><br><span class="line">inner join movies c</span><br><span class="line">on c.movie_id = b.movie_id</span><br><span class="line">group by a.gender, c.title</span><br><span class="line">order by c.title </span><br><span class="line"></span><br><span class="line">select * from temp_result</span><br><span class="line">where (年龄段, 平均评分, rownum) in </span><br><span class="line">(</span><br><span class="line">    select a.年龄段, a.平均评分, max(a.rownum) from </span><br><span class="line">    (</span><br><span class="line">        select rownum, 年龄段, 平均评分, title </span><br><span class="line">            from temp_result </span><br><span class="line">            where (年龄段, 平均评分) in (</span><br><span class="line">            select 年龄段, max(平均评分)</span><br><span class="line">            from temp_result</span><br><span class="line">            group by 年龄段</span><br><span class="line">        )</span><br><span class="line">    ) a </span><br><span class="line">    group by a.年龄段, a.平均评分</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
            </div>

            <!-- Post Comments -->
            

        </div>
        <!-- Copyright 版权 start -->
                <div id="copyright">
            <ul>
                <li>&copy;Powered By <a href="https://hexo.io/zh-cn/" style="border-bottom: none;">hexo</a></li>
                <li>Design: <a href="http://miccall.tech " style="border-bottom: none;">miccall</a></li>
            </ul>
            
                <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
			
        </div>
    </div>
</body>



 	
</html>
