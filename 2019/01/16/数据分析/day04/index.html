<!DOCTYPE HTML>
<html>

<head><meta name="generator" content="Hexo 3.8.0">
	<link rel="bookmark" type="image/x-icon" href="/img/logo_miccall.png">
	<link rel="shortcut icon" href="/img/logo_miccall.png">
	
			    <title>
    ytq520
    </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link rel="stylesheet" href="/css/mic_main.css">
    <link rel="stylesheet" href="/css/dropdownMenu.css">
    <meta name="keywords" content="miccall">
    
    	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	 
    <noscript>
        <link rel="stylesheet" href="/css/noscript.css">
    </noscript>
    <style type="text/css">
        body:before {
          content: ' ';
          position: fixed;
          top: 0;
          background: url('/img/bg.jpg') center 0 no-repeat;
          right: 0;
          bottom: 0;
          left: 0;
          background-size: cover; 
        }
    </style>

			    
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script async type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.scrollex.min.js"></script>
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/skel.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
	
</head>
    
		
<!-- Layouts -->



<!--  代码渲染  -->
<link rel="stylesheet" href="/css/prism_coy.css">
<link rel="stylesheet" href="/css/typo.css">
<!-- 文章页 -->
<body class="is-loading">
    <!-- Wrapper 外包 s-->
    <div id="wrapper" class="fade-in">
        <!-- Intro 头部显示 s -->
        <!-- Intro 头部显示 e -->
        <!-- Header 头部logo start -->
        <header id="header">
    <a href="/" class="logo">ytq520</a>
</header>
        <!-- Nav 导航条 start -->
        <nav id="nav" class="special">
            <ul class="menu links">
			<!-- Homepage  主页  --> 
			<li>
	            <a href="/" rel="nofollow">主页</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">分类</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="category-link" href="/categories/Data-Analysis/">Data Analysis</a></li><li><a class="category-link" href="/categories/Django/">Django</a></li><li><a class="category-link" href="/categories/JavaScript/">JavaScript</a></li><li><a class="category-link" href="/categories/MySQL/">MySQL</a></li><li><a class="category-link" href="/categories/html/">html</a></li><li><a class="category-link" href="/categories/python基础/">python基础</a>
	                    </li></ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/gallery/" title="图库">
		                图库
		            </a>
		        </li>
		        
		        <li>
		            <a href="/tag/" title="标签">
		                标签
		            </a>
		        </li>
		        


            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
                    
                    <li>
                        <a title="github" href="https://github.com/ytq520" target="_blank" rel="noopener">
                            <i class="icon fa fa-github"></i>
                        </a>
                    </li>
                    
                    <li>
                        <a title="500px" href="http://500px.com" target="_blank" rel="noopener">
                            <i class="icon fa fa-500px"></i>
                        </a>
                    </li>
                    
			</ul>
</nav>

        <div id="main">
            <div class="post_page_title_img" style="height: 25rem;background-image: url(/images/thumbs/07.jpg);background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;">
                <a href="#" style="padding: 4rem 4rem 2rem 4rem ;"><h2>数据加载、存储和⽂件格式、数据清洗和准备</h2></a>
            </div>
            <!-- Post -->
            <div class="typo" style="padding: 3rem;">
                <p>###数据加载、存储和⽂件格式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br></pre></td><td class="code"><pre><span class="line">读写⽂本格式的数据</span><br><span class="line">pandas提供了⼀些⽤于将表格型数据读取为DataFrame对象的函数，其中read_csv和</span><br><span class="line">read_table⽤得最多</span><br><span class="line">将⽂本数据转换为DataFrame时所⽤到的⼀些技术</span><br><span class="line">索引：将⼀个或多个列当做返回的DataFrame处理，以及是否从⽂件、⽤户获取列名</span><br><span class="line">类型推断和数据转换：包括⽤户定义值的转换、和⾃定义的缺失值标记列表等</span><br><span class="line">⽇期解析：包括组合功能，⽐如将分散在多个列中的⽇期时间信息组合成结果中的单个列</span><br><span class="line">迭代：⽀持对⼤⽂件进⾏逐块迭代</span><br><span class="line">不规整数据问题：跳过⼀些⾏、⻚脚、注释或其他⼀些不重要的东⻄（⽐如由成千上万个逗号</span><br><span class="line">隔开的数值数据）</span><br><span class="line">read_csv有超过50个参数</span><br><span class="line">以逗号分隔的（CSV）⽂本⽂件例⼦</span><br><span class="line"># Windows，你可以使⽤type达到同样的效果</span><br><span class="line">In [8]: !cat examples/ex1.csv</span><br><span class="line">a,b,c,d,message</span><br><span class="line">1,2,3,4,hello</span><br><span class="line">5,6,7,8,world</span><br><span class="line">9,10,11,12,foo</span><br><span class="line">In [9]: df = pd.read_csv(&apos;examples/ex1.csv&apos;)</span><br><span class="line">In [10]: df</span><br><span class="line">Out[10]:</span><br><span class="line"> a b c d message</span><br><span class="line">0 1 2 3 4 hello</span><br><span class="line">1 5 6 7 8 world</span><br><span class="line">2 9 10 11 12 foo</span><br><span class="line">使⽤read_table，并指定分隔符</span><br><span class="line">In [11]: pd.read_table(&apos;examples/ex1.csv&apos;, sep=&apos;,&apos;)</span><br><span class="line">Out[11]:</span><br><span class="line"> a b c d message</span><br><span class="line">0 1 2 3 4 hello</span><br><span class="line">1 5 6 7 8 world</span><br><span class="line">2 9 10 11 12 foo</span><br><span class="line">没有标题的⽂件</span><br><span class="line">In [12]: !cat examples/ex2.csv</span><br><span class="line">1,2,3,4,hello</span><br><span class="line">5,6,7,8,world</span><br><span class="line">9,10,11,12,foo</span><br><span class="line">可以让pandas为其分配默认的列名，也可以⾃⼰定义列名</span><br><span class="line"># 试下不加header</span><br><span class="line">In [13]: pd.read_csv(&apos;examples/ex2.csv&apos;, header=None)</span><br><span class="line">Out[13]:</span><br><span class="line"> 0 1 2 3 4</span><br><span class="line">0 1 2 3 4 hello</span><br><span class="line">1 5 6 7 8 world</span><br><span class="line">2 9 10 11 12 foo</span><br><span class="line">In [14]: pd.read_csv(&apos;examples/ex2.csv&apos;, names=[&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;, &apos;message&apos;])</span><br><span class="line">Out[14]:</span><br><span class="line"> a b c d message</span><br><span class="line">0 1 2 3 4 hello</span><br><span class="line">1 5 6 7 8 world</span><br><span class="line">2 9 10 11 12 foo</span><br><span class="line">假设你希望将message列做成DataFrame的索引。你可以明确表示要将该列放到索引4的位置</span><br><span class="line">上，也可以通过index_col参数指定”message”</span><br><span class="line">In [15]: names = [&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;, &apos;message&apos;]</span><br><span class="line">In [16]: pd.read_csv(&apos;examples/ex2.csv&apos;, names=names, index_col=&apos;message&apos;)</span><br><span class="line">Out[16]:</span><br><span class="line"> a b c d</span><br><span class="line">message</span><br><span class="line">hello 1 2 3 4</span><br><span class="line">world 5 6 7 8</span><br><span class="line">foo 9 10 11 12</span><br><span class="line">将多个列做成⼀个层次化索引，只需传⼊由列编号或列名组成的列表即可</span><br><span class="line">In [17]: !cat examples/csv_mindex.csv</span><br><span class="line">key1,key2,value1,value2</span><br><span class="line">one,a,1,2</span><br><span class="line">one,b,3,4</span><br><span class="line">one,c,5,6</span><br><span class="line">one,d,7,8</span><br><span class="line">two,a,9,10</span><br><span class="line">two,b,11,12</span><br><span class="line">two,c,13,14</span><br><span class="line">two,d,15,16</span><br><span class="line">In [18]: parsed = pd.read_csv(&apos;examples/csv_mindex.csv&apos;,</span><br><span class="line"> ....: index_col=[&apos;key1&apos;, &apos;key2&apos;])</span><br><span class="line">In [19]: parsed</span><br><span class="line">Out[19]:</span><br><span class="line"> value1 value2</span><br><span class="line">key1 key2</span><br><span class="line">one a 1 2</span><br><span class="line"> b 3 4</span><br><span class="line"> c 5 6</span><br><span class="line"> d 7 8</span><br><span class="line">two a 9 10</span><br><span class="line"> b 11 12</span><br><span class="line"> c 13 14</span><br><span class="line"> d 15 16</span><br><span class="line">有些表格可能不是⽤固定的分隔符去分隔字段的（⽐如空⽩符或其它模式</span><br><span class="line">In [20]: list(open(&apos;examples/ex3.txt&apos;))</span><br><span class="line">Out[20]:</span><br><span class="line">[&apos; A B C\n&apos;,</span><br><span class="line"> &apos;aaa -0.264438 -1.026059 -0.619500\n&apos;,</span><br><span class="line"> &apos;bbb 0.927272 0.302904 -0.032399\n&apos;,</span><br><span class="line"> &apos;ccc -0.264273 -0.386314 -0.217601\n&apos;,</span><br><span class="line"> &apos;ddd -0.871858 -0.348382 1.100491\n&apos;]</span><br><span class="line">虽然可以⼿动对数据进⾏规整，这⾥的字段是被数量不同的空⽩字符间隔开的。这种情况下，</span><br><span class="line">你可以传递⼀个正则表达式作为read_table的分隔符。可以⽤正则表达式表达为\s+</span><br><span class="line"># 由于列名⽐数据⾏的数量少，所以read_table推断第⼀列应该是DataFrame的索引</span><br><span class="line">In [21]: result = pd.read_table(&apos;examples/ex3.txt&apos;, sep=&apos;\s+&apos;)</span><br><span class="line">In [22]: result</span><br><span class="line">Out[22]:</span><br><span class="line"> A B C</span><br><span class="line">aaa -0.264438 -1.026059 -0.619500</span><br><span class="line">bbb 0.927272 0.302904 -0.032399</span><br><span class="line">ccc -0.264273 -0.386314 -0.217601</span><br><span class="line">ddd -0.871858 -0.348382 1.100491</span><br><span class="line">异形⽂件格式处理，你可以⽤skiprows跳过⽂件的第⼀⾏、第三⾏和第四⾏</span><br><span class="line">In [23]: !cat examples/ex4.csv</span><br><span class="line"># hey!</span><br><span class="line">a,b,c,d,message</span><br><span class="line"># just wanted to make things more difficult for you</span><br><span class="line"># who reads CSV files with computers, anyway?</span><br><span class="line">1,2,3,4,hello</span><br><span class="line">5,6,7,8,world</span><br><span class="line">9,10,11,12,foo</span><br><span class="line">In [24]: pd.read_csv(&apos;examples/ex4.csv&apos;, skiprows=[0, 2, 3])</span><br><span class="line">Out[24]:</span><br><span class="line"> a b c d message</span><br><span class="line">0 1 2 3 4 hello</span><br><span class="line">1 5 6 7 8 world</span><br><span class="line">2 9 10 11 12 foo</span><br><span class="line">缺失值处理是⽂件解析任务中的⼀个重要组成部分。缺失数据经常是要么没有（空字符串），</span><br><span class="line">要么⽤某个标记值表示。默认情况下，pandas会⽤⼀组经常出现的标记值进⾏识别，⽐如NA</span><br><span class="line">及NULL</span><br><span class="line">In [25]: !cat examples/ex5.csv</span><br><span class="line">something,a,b,c,d,message</span><br><span class="line">one,1,2,3,4,NA</span><br><span class="line">two,5,6,,8,world</span><br><span class="line">three,9,10,11,12,foo</span><br><span class="line">In [26]: result = pd.read_csv(&apos;examples/ex5.csv&apos;)</span><br><span class="line">In [27]: result</span><br><span class="line">Out[27]:</span><br><span class="line"> something a b c d message</span><br><span class="line">0 one 1 2 3.0 4 NaN</span><br><span class="line">1 two 5 6 NaN 8 world</span><br><span class="line">2 three 9 10 11.0 12 foo</span><br><span class="line">In [28]: pd.isnull(result)</span><br><span class="line">Out[28]:</span><br><span class="line"> something a b c d message</span><br><span class="line">0 False False False False False True</span><br><span class="line">1 False False False True False False</span><br><span class="line">2 False False False False False False</span><br><span class="line">na_values可以⽤⼀个列表或集合的字符串表示缺失值</span><br><span class="line">In [29]: result = pd.read_csv(&apos;examples/ex5.csv&apos;, na_values=[&apos;NULL&apos;])</span><br><span class="line">In [30]: result</span><br><span class="line">Out[30]:</span><br><span class="line"> something a b c d message</span><br><span class="line">0 one 1 2 3.0 4 NaN</span><br><span class="line">1 two 5 6 NaN 8 world</span><br><span class="line">2 three 9 10 11.0 12 foo</span><br><span class="line">字典的各列可以使⽤不同的NA标记值</span><br><span class="line">In [31]: sentinels = &#123;&apos;message&apos;: [&apos;foo&apos;, &apos;NA&apos;], &apos;something&apos;: [&apos;two&apos;]&#125;</span><br><span class="line">In [32]: pd.read_csv(&apos;examples/ex5.csv&apos;, na_values=sentinels)</span><br><span class="line">Out[32]:</span><br><span class="line">something a b c d message</span><br><span class="line">0 one 1 2 3.0 4 NaN</span><br><span class="line">1 NaN 5 6 NaN 8 world</span><br><span class="line">2 three 9 10 11.0 12 NaN</span><br><span class="line">逐块读取⽂本⽂件</span><br><span class="line">在处理很⼤的⽂件时，或找出⼤⽂件中的参数集以便于后续处理时，可以读取⽂件的⼀⼩部分</span><br><span class="line">或逐块对⽂件进⾏迭代</span><br><span class="line">设置pandas显示地更紧些</span><br><span class="line">In [33]: pd.options.display.max_rows = 10</span><br><span class="line">In [34]: result = pd.read_csv(&apos;examples/ex6.csv&apos;)</span><br><span class="line">In [35]: result</span><br><span class="line">Out[35]:</span><br><span class="line"> one two three four key</span><br><span class="line">0 0.467976 -0.038649 -0.295344 -1.824726 L</span><br><span class="line">1 -0.358893 1.404453 0.704965 -0.200638 B</span><br><span class="line">2 -0.501840 0.659254 -0.421691 -0.057688 G</span><br><span class="line">3 0.204886 1.074134 1.388361 -0.982404 R</span><br><span class="line">4 0.354628 -0.133116 0.283763 -0.837063 Q</span><br><span class="line">... ... ... ... ... ..</span><br><span class="line">9995 2.311896 -0.417070 -1.409599 -0.515821 L</span><br><span class="line">9996 -0.479893 -0.650419 0.745152 -0.646038 E</span><br><span class="line">9997 0.523331 0.787112 0.486066 1.093156 K</span><br><span class="line">9998 -0.362559 0.598894 -1.843201 0.887292 G</span><br><span class="line">9999 -0.096376 -1.012999 -0.657431 -0.573315 0</span><br><span class="line">[10000 rows x 5 columns]</span><br><span class="line">如果只想读取⼏⾏（避免读取整个⽂件），通过nrows进⾏指定即可</span><br><span class="line">In [36]: pd.read_csv(&apos;examples/ex6.csv&apos;, nrows=5)</span><br><span class="line">Out[36]:</span><br><span class="line"> one two three four key</span><br><span class="line">0 0.467976 -0.038649 -0.295344 -1.824726 L</span><br><span class="line">1 -0.358893 1.404453 0.704965 -0.200638 B</span><br><span class="line">2 -0.501840 0.659254 -0.421691 -0.057688 G</span><br><span class="line">3 0.204886 1.074134 1.388361 -0.982404 R</span><br><span class="line">4 0.354628 -0.133116 0.283763 -0.837063 Q</span><br><span class="line">要逐块读取⽂件，可以指定chunksize（⾏数）</span><br><span class="line">In [874]: chunker = pd.read_csv(&apos;examples/ex6.csv&apos;, chunksize=1000)</span><br><span class="line">In [875]: chunker</span><br><span class="line">Out[875]: &lt;pandas.io.parsers.TextParser at 0x8398150&gt;</span><br><span class="line">read_csv所返回的这个TextParser对象使你可以根据chunksize对⽂件进⾏逐块迭代。⽐如说，</span><br><span class="line">我们可以迭代处理ex6.csv，将值计数聚合到”key”列中</span><br><span class="line">tot = pd.Series([])</span><br><span class="line">for piece in chunker:</span><br><span class="line"> tot = tot.add(piece[&apos;key&apos;].value_counts(), fill_value=0)</span><br><span class="line">tot = tot.sort_values(ascending=False)</span><br><span class="line">In [40]: tot[:10]</span><br><span class="line">Out[40]:</span><br><span class="line">E 368.0</span><br><span class="line">X 364.0</span><br><span class="line">L 346.0</span><br><span class="line">O 343.0</span><br><span class="line">Q 340.0</span><br><span class="line">M 338.0</span><br><span class="line">J 337.0</span><br><span class="line">F 335.0</span><br><span class="line">K 334.0</span><br><span class="line">H 330.0</span><br><span class="line">dtype: float64</span><br><span class="line">将数据写出到⽂本格式</span><br><span class="line">数据也可以被输出为分隔符格式的⽂本</span><br><span class="line">In [41]: data = pd.read_csv(&apos;examples/ex5.csv&apos;)</span><br><span class="line">In [42]: data</span><br><span class="line">Out[42]:</span><br><span class="line"> something a b c d message</span><br><span class="line">0 one 1 2 3.0 4 NaN</span><br><span class="line">1 two 5 6 NaN 8 world</span><br><span class="line">2 three 9 10 11.0 12 foo</span><br><span class="line">DataFrame的to_csv⽅法，我们可以将数据写到⼀个以逗号分隔的⽂件中</span><br><span class="line">In [43]: data.to_csv(&apos;examples/out.csv&apos;)</span><br><span class="line">In [44]: !cat examples/out.csv</span><br><span class="line">,something,a,b,c,d,message</span><br><span class="line">0,one,1,2,3.0,4,</span><br><span class="line">1,two,5,6,,8,world</span><br><span class="line">2,three,9,10,11.0,12,foo</span><br><span class="line">使⽤其他分隔符（由于这⾥直接写出到sys.stdout，所以仅仅是打印出⽂本结果⽽已）</span><br><span class="line">In [45]: import sys</span><br><span class="line">In [46]: data.to_csv(sys.stdout, sep=&apos;|&apos;)</span><br><span class="line">|something|a|b|c|d|message</span><br><span class="line">0|one|1|2|3.0|4|</span><br><span class="line">1|two|5|6||8|world</span><br><span class="line">2|three|9|10|11.0|12|foo</span><br><span class="line">缺失值在输出结果中会被表示为空字符串。你可能希望将其表示为别的标记值</span><br><span class="line">In [47]: data.to_csv(sys.stdout, na_rep=&apos;NULL&apos;)</span><br><span class="line">,something,a,b,c,d,message</span><br><span class="line">0,one,1,2,3.0,4,NULL</span><br><span class="line">1,two,5,6,NULL,8,world</span><br><span class="line">2,three,9,10,11.0,12,foo</span><br><span class="line">没有设置其他选项，则会写出⾏和列的标签。当然，它们也都可以被禁⽤</span><br><span class="line">In [48]: data.to_csv(sys.stdout, index=False, header=False)</span><br><span class="line">one,1,2,3.0,4,</span><br><span class="line">two,5,6,,8,world</span><br><span class="line">three,9,10,11.0,12,foo</span><br><span class="line">你还可以只写出⼀部分的列，并以你指定的顺序排列</span><br><span class="line">In [49]: data.to_csv(sys.stdout, index=False, columns=[&apos;a&apos;, &apos;b&apos;, &apos;c&apos;])</span><br><span class="line">a,b,c</span><br><span class="line">1,2,3.0</span><br><span class="line">5,6,</span><br><span class="line">9,10,11.0</span><br><span class="line">In [50]: dates = pd.date_range(&apos;1/1/2000&apos;, periods=7)</span><br><span class="line">In [51]: ts = pd.Series(np.arange(7), index=dates)</span><br><span class="line">In [52]: ts.to_csv(&apos;examples/tseries.csv&apos;)</span><br><span class="line">In [53]: !cat examples/tseries.csv</span><br><span class="line">2000-01-01,0</span><br><span class="line">2000-01-02,1</span><br><span class="line">2000-01-03,2</span><br><span class="line">2000-01-04,3</span><br><span class="line">2000-01-05,4</span><br><span class="line">2000-01-06,5</span><br><span class="line">2000-01-07,6</span><br><span class="line">处理分隔符格式</span><br><span class="line">JSON数据</span><br><span class="line">pandas.read_json可以⾃动将特别格式的JSON数据集转换为Series或DataFrame</span><br><span class="line">In [68]: !cat examples/example.json</span><br><span class="line">[&#123;&quot;a&quot;: 1, &quot;b&quot;: 2, &quot;c&quot;: 3&#125;,</span><br><span class="line"> &#123;&quot;a&quot;: 4, &quot;b&quot;: 5, &quot;c&quot;: 6&#125;,</span><br><span class="line"> &#123;&quot;a&quot;: 7, &quot;b&quot;: 8, &quot;c&quot;: 9&#125;]</span><br><span class="line">In [69]: data = pd.read_json(&apos;examples/example.json&apos;)</span><br><span class="line">In [70]: data</span><br><span class="line">Out[70]:</span><br><span class="line"> a b c</span><br><span class="line">0 1 2 3</span><br><span class="line">1 4 5 6</span><br><span class="line">2 7 8 9</span><br><span class="line">从pandas输出到JSON，使⽤to_json⽅法</span><br><span class="line">In [71]: print(data.to_json())</span><br><span class="line">&#123;&quot;a&quot;:&#123;&quot;0&quot;:1,&quot;1&quot;:4,&quot;2&quot;:7&#125;,&quot;b&quot;:&#123;&quot;0&quot;:2,&quot;1&quot;:5,&quot;2&quot;:8&#125;,&quot;c&quot;:&#123;&quot;0&quot;:3,&quot;1&quot;:6,&quot;2&quot;:9&#125;&#125;</span><br><span class="line">In [72]: print(data.to_json(orient=&apos;records&apos;))</span><br><span class="line">[&#123;&quot;a&quot;:1,&quot;b&quot;:2,&quot;c&quot;:3&#125;,&#123;&quot;a&quot;:4,&quot;b&quot;:5,&quot;c&quot;:6&#125;,&#123;&quot;a&quot;:7,&quot;b&quot;:8,&quot;c&quot;:9&#125;]</span><br><span class="line">XML和HTML：Web信息收集</span><br><span class="line">pandas有⼀个内置的功能，read_html，它可以使⽤lxml和Beautiful Soup⾃动将HTML⽂件</span><br><span class="line">中的表格解析为DataFrame对象。</span><br><span class="line">使⽤例⼦数据：美国联邦存款保险公司⼀个HTML⽂件，它记录了银⾏倒闭的情况。</span><br><span class="line">安装read_html⽤到的库</span><br><span class="line">conda install lxml</span><br><span class="line">pip install beautifulsoup4 html5lib</span><br><span class="line">In [73]: tables = pd.read_html(&apos;examples/fdic_failed_bank_list.html&apos;)</span><br><span class="line">In [74]: len(tables)</span><br><span class="line">Out[74]: 1</span><br><span class="line">In [75]: failures = tables[0]</span><br><span class="line">In [76]: failures.head()</span><br><span class="line">Out[76]:</span><br><span class="line"> Bank Name City ST CERT \</span><br><span class="line">0 Allied Bank Mulberry AR 91</span><br><span class="line">1 The Woodbury Banking Company Woodbury GA 11297</span><br><span class="line">2 First CornerStone Bank King of Prussia PA 35312</span><br><span class="line">3 Trust Company Bank Memphis TN 9956</span><br><span class="line">4 North Milwaukee State Bank Milwaukee WI 20364</span><br><span class="line">做⼀些数据清洗和分析，⽐如计算按年份计算倒闭的银⾏数</span><br><span class="line">In [77]: close_timestamps = pd.to_datetime(failures[&apos;Closing Date&apos;])</span><br><span class="line">In [78]: close_timestamps.dt.year.value_counts()</span><br><span class="line">Out[78]:</span><br><span class="line">2010 157</span><br><span class="line">2009 140</span><br><span class="line">2011 92</span><br><span class="line">2012 51</span><br><span class="line">2008 25</span><br><span class="line"> ...</span><br><span class="line">2004 4</span><br><span class="line">2001 4</span><br><span class="line">2007 3</span><br><span class="line">2003 3</span><br><span class="line">2000 2</span><br><span class="line">Name: Closing Date, Length: 15, dtype: int64</span><br><span class="line">⼆进制数据格式</span><br><span class="line">pandas对象都有⼀个⽤于将数据以pickle格式保存到磁盘上的to_pickle⽅法</span><br><span class="line">In [87]: frame = pd.read_csv(&apos;examples/ex1.csv&apos;)</span><br><span class="line">In [88]: frame</span><br><span class="line">Out[88]:</span><br><span class="line"> a b c d message</span><br><span class="line">0 1 2 3 4 hello</span><br><span class="line">1 5 6 7 8 world</span><br><span class="line">2 9 10 11 12 foo</span><br><span class="line">In [89]: frame.to_pickle(&apos;examples/frame_pickle&apos;)</span><br><span class="line">读取pickle数据</span><br><span class="line">In [90]: pd.read_pickle(&apos;examples/frame_pickle&apos;)</span><br><span class="line">Out[90]:</span><br><span class="line"> a b c d message</span><br><span class="line">0 1 2 3 4 hello</span><br><span class="line">1 5 6 7 8 world</span><br><span class="line">2 9 10 11 12 foo</span><br><span class="line">注意： pickle仅建议⽤于短期存储格式。其原因是很难保证该格式永远是稳定的；今天pickle</span><br><span class="line">的对象可能⽆法被后续版本的库unpickle出来</span><br><span class="line">使⽤HDF5格式</span><br><span class="line">HDF5是⼀种存储⼤规模科学数组数据的⾮常好的⽂件格式。它可以被作为C标准库，带有许</span><br><span class="line">多语⾔的接⼝，如Java、Python和MATLAB等。HDF5中的HDF指的是层次型数据格式</span><br><span class="line">（hierarchical data format）。每个HDF5⽂件都含有⼀个⽂件系统式的节点结构，它使你能</span><br><span class="line">够存储多个数据集并⽀持元数据。与其他简单格式相⽐，HDF5⽀持多种压缩器的即时压缩，</span><br><span class="line">还能更⾼效地存储重复模式数据。对于那些⾮常⼤的⽆法直接放⼊内存的数据集，HDF5就是</span><br><span class="line">不错的选择，因为它可以⾼效地分块读写。</span><br><span class="line">In [92]: frame = pd.DataFrame(&#123;&apos;a&apos;: np.random.randn(100)&#125;)</span><br><span class="line">In [93]: store = pd.HDFStore(&apos;mydata.h5&apos;)</span><br><span class="line">In [94]: store[&apos;obj1&apos;] = frame</span><br><span class="line">In [95]: store[&apos;obj1_col&apos;] = frame[&apos;a&apos;]</span><br><span class="line">In [96]: store</span><br><span class="line">Out[96]:</span><br><span class="line">&lt;class &apos;pandas.io.pytables.HDFStore&apos;&gt;</span><br><span class="line">File path: mydata.h5</span><br><span class="line">HDF5⽂件中的对象可以通过与字典⼀样的API进⾏获取</span><br><span class="line">In [97]: store[&apos;obj1&apos;]</span><br><span class="line">Out[97]:</span><br><span class="line"> a</span><br><span class="line">0 -0.204708</span><br><span class="line">1 0.478943</span><br><span class="line">2 -0.519439</span><br><span class="line">3 -0.555730</span><br><span class="line">4 1.965781</span><br><span class="line">.. ...</span><br><span class="line">95 0.795253</span><br><span class="line">96 0.118110</span><br><span class="line">97 -0.748532</span><br><span class="line">98 0.584970</span><br><span class="line">99 0.152677</span><br><span class="line">[100 rows x 1 columns]</span><br><span class="line">HDFStore⽀持两种存储模式，’fixed’和’table’。后者通常会更慢，但是⽀持使⽤特殊语法进⾏</span><br><span class="line">查询操作</span><br><span class="line">In [98]: store.put(&apos;obj2&apos;, frame, format=&apos;table&apos;)</span><br><span class="line">In [99]: store.select(&apos;obj2&apos;, where=[&apos;index &gt;= 10 and index &lt;= 15&apos;])</span><br><span class="line">Out[99]:</span><br><span class="line"> a</span><br><span class="line">10 1.007189</span><br><span class="line">11 -1.296221</span><br><span class="line">12 0.274992</span><br><span class="line">13 0.228913</span><br><span class="line">14 1.352917</span><br><span class="line">15 0.886429</span><br><span class="line">In [100]: store.close()</span><br><span class="line">pandas.read_hdf函数可以快捷使⽤这些⼯具</span><br><span class="line">In [101]: frame.to_hdf(&apos;mydata.h5&apos;, &apos;obj3&apos;, format=&apos;table&apos;)</span><br><span class="line">In [102]: pd.read_hdf(&apos;mydata.h5&apos;, &apos;obj3&apos;, where=[&apos;index &lt; 5&apos;])</span><br><span class="line">Out[102]:</span><br><span class="line"> a</span><br><span class="line">0 -0.204708</span><br><span class="line">1 0.478943</span><br><span class="line">2 -0.519439</span><br><span class="line">3 -0.555730</span><br><span class="line">4 1.965781</span><br><span class="line">读取Microsoft Excel⽂件</span><br><span class="line">pandas的ExcelFile类或pandas.read_excel函数⽀持读取存储在Excel 2003（或更⾼版本）中</span><br><span class="line">的表格型数据。这两个⼯具分别使⽤扩展包xlrd和openpyxl读取XLS和XLSX⽂件。你可以⽤</span><br><span class="line">pip或conda安装它们</span><br><span class="line">In [104]: xlsx = pd.ExcelFile(&apos;examples/ex1.xlsx&apos;)</span><br><span class="line">In [105]: pd.read_excel(xlsx, &apos;Sheet1&apos;)</span><br><span class="line">Out[105]:</span><br><span class="line"> a b c d message</span><br><span class="line">0 1 2 3 4 hello</span><br><span class="line">1 5 6 7 8 world</span><br><span class="line">2 9 10 11 12 foo</span><br><span class="line">In [106]: frame = pd.read_excel(&apos;examples/ex1.xlsx&apos;, &apos;Sheet1&apos;)</span><br><span class="line">In [107]: frame</span><br><span class="line">Out[107]:</span><br><span class="line"> a b c d message</span><br><span class="line">0 1 2 3 4 hello</span><br><span class="line">1 5 6 7 8 world</span><br><span class="line">2 9 10 11 12 foo</span><br><span class="line">将pandas数据写⼊为Excel格式</span><br><span class="line">In [108]: writer = pd.ExcelWriter(&apos;examples/ex2.xlsx&apos;)</span><br><span class="line">In [109]: frame.to_excel(writer, &apos;Sheet1&apos;)</span><br><span class="line">In [110]: writer.save()</span><br><span class="line">也可以这样存</span><br><span class="line">In [111]: frame.to_excel(&apos;examples/ex2.xlsx&apos;)</span><br><span class="line">Web APIs交互</span><br><span class="line">In [113]: import requests</span><br><span class="line">In [114]: url = &apos;https://api.github.com/repos/pandas-dev/pandas/issues&apos;</span><br><span class="line">In [115]: resp = requests.get(url)</span><br><span class="line">In [116]: resp</span><br><span class="line">Out[116]: &lt;Response [200]&gt;</span><br><span class="line">In [117]: data = resp.json()</span><br><span class="line">In [118]: data[0][&apos;title&apos;]</span><br><span class="line">Out[118]: &apos;Period does not round down for frequencies less that 1 hour&apos;</span><br><span class="line">In [119]: issues = pd.DataFrame(data, columns=[&apos;number&apos;, &apos;title&apos;,</span><br><span class="line"> .....: &apos;labels&apos;, &apos;state&apos;])</span><br><span class="line">In [120]: issues</span><br><span class="line">Out[120]:</span><br><span class="line"> number title \</span><br><span class="line">0 17666 Period does not round down for frequencies les...</span><br><span class="line">1 17665 DOC: improve docstring of function where</span><br><span class="line">2 17664 COMPAT: skip 32-bit test on int repr</span><br><span class="line">3 17662 implement Delegator class</span><br><span class="line">4 17654 BUG: Fix series rename called with str alterin...</span><br><span class="line">.. ... ...</span><br><span class="line">25 17603 BUG: Correctly localize naive datetime strings...</span><br><span class="line">26 17599 core.dtypes.generic --&gt; cython</span><br><span class="line">27 17596 Merge cdate_range functionality into bdate_range </span><br><span class="line">28 17587 Time Grouper bug fix when applied for list gro...</span><br><span class="line">29 17583 BUG: fix tz-aware DatetimeIndex + TimedeltaInd...</span><br><span class="line">[30 rows x 4 columns]</span><br><span class="line">数据库交互</span><br><span class="line">在商业场景下，⼤多数数据可能不是存储在⽂本或Excel⽂件中。基于SQL的关系型数据库</span><br><span class="line">（如SQL Server、PostgreSQL和MySQL等）使⽤⾮常⼴泛。</span><br><span class="line">In [121]: import sqlite3</span><br><span class="line">In [122]: query = &quot;&quot;&quot;</span><br><span class="line"> .....: CREATE TABLE test</span><br><span class="line"> .....: (a VARCHAR(20), b VARCHAR(20),</span><br><span class="line"> .....: c REAL, d INTEGER</span><br><span class="line"> .....: );&quot;&quot;&quot;</span><br><span class="line">In [123]: con = sqlite3.connect(&apos;mydata.sqlite&apos;)</span><br><span class="line">In [124]: con.execute(query)</span><br><span class="line">Out[124]: &lt;sqlite3.Cursor at 0x7f6b12a50f10&gt;</span><br><span class="line">In [125]: con.commit()</span><br><span class="line">In [126]: data = [(&apos;Atlanta&apos;, &apos;Georgia&apos;, 1.25, 6),</span><br><span class="line"> .....: (&apos;Tallahassee&apos;, &apos;Florida&apos;, 2.6, 3),</span><br><span class="line"> .....: (&apos;Sacramento&apos;, &apos;California&apos;, 1.7, 5)]</span><br><span class="line">In [127]: stmt = &quot;INSERT INTO test VALUES(?, ?, ?, ?)&quot;</span><br><span class="line">In [128]: con.executemany(stmt, data)</span><br><span class="line">Out[128]: &lt;sqlite3.Cursor at 0x7f6b15c66ce0&gt;</span><br><span class="line">In [130]: cursor = con.execute(&apos;select * from test&apos;)</span><br><span class="line">In [131]: rows = cursor.fetchall()</span><br><span class="line">In [132]: rows</span><br><span class="line">Out[132]:</span><br><span class="line">[(&apos;Atlanta&apos;, &apos;Georgia&apos;, 1.25, 6),</span><br><span class="line"> (&apos;Tallahassee&apos;, &apos;Florida&apos;, 2.6, 3),</span><br><span class="line"> (&apos;Sacramento&apos;, &apos;California&apos;, 1.7, 5)]</span><br><span class="line">In [133]: cursor.description</span><br><span class="line">Out[133]:</span><br><span class="line">((&apos;a&apos;, None, None, None, None, None, None),</span><br><span class="line"> (&apos;b&apos;, None, None, None, None, None, None),</span><br><span class="line"> (&apos;c&apos;, None, None, None, None, None, None),</span><br><span class="line"> (&apos;d&apos;, None, None, None, None, None, None))</span><br><span class="line">In [134]: pd.DataFrame(rows, columns=[x[0] for x in cursor.description])</span><br><span class="line">Out[134]:</span><br><span class="line"> a b c d</span><br><span class="line">0 Atlanta Georgia 1.25 6</span><br><span class="line">1 Tallahassee Florida 2.60 3</span><br><span class="line">2 Sacramento California 1.70 5</span><br><span class="line">这种数据规整操作相当多，你肯定不想每查⼀次数据库就重写⼀次。SQLAlchemy项⽬是⼀个</span><br><span class="line">流⾏的Python SQL⼯具，它抽象出了SQL数据库中的许多常⻅差异。pandas有⼀个read_sql</span><br><span class="line">函数，可以让你轻松的从SQLAlchemy连接读取数据。</span><br><span class="line">In [135]: import sqlalchemy as sqla</span><br><span class="line">db= sqla.create_engine(&apos;mysql+pymysql://root:123456@127.0.0.1/taobao?</span><br><span class="line">charset=utf8&apos;)</span><br><span class="line">In [137]: pd.read_sql(&apos;select * from product&apos;, db)</span><br></pre></td></tr></table></figure></p>
<p>###数据清洗和准备<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br></pre></td><td class="code"><pre><span class="line">在数据分析和建模的过程中，相当多的时间要⽤在数据准备上：加载、清理、转换以及重塑。</span><br><span class="line">这些⼯作会占到分析师时间的80%或更多。</span><br><span class="line">pandas和内置的Python标准库提供了⼀组⾼级的、灵活的、快速的⼯具，可以让你轻松地将</span><br><span class="line">数据规整为想要的格式。</span><br><span class="line">处理缺失数据</span><br><span class="line">检测缺失数据</span><br><span class="line">In [10]: string_data = pd.Series([&apos;aardvark&apos;, &apos;artichoke&apos;, np.nan, &apos;avocado&apos;])</span><br><span class="line">In [11]: string_data</span><br><span class="line">Out[11]:</span><br><span class="line">0 aardvark</span><br><span class="line">1 artichoke</span><br><span class="line">2 NaN</span><br><span class="line">3 avocado</span><br><span class="line">dtype: object</span><br><span class="line">In [12]: string_data.isnull()</span><br><span class="line">Out[12]:</span><br><span class="line">0 False</span><br><span class="line">1 False</span><br><span class="line">2 True</span><br><span class="line">3 False</span><br><span class="line">dtype: bool</span><br><span class="line">在统计应⽤中，NA数据可能是不存在的数据或者虽然存在，但是没有观察到（例如，数据采</span><br><span class="line">集中发⽣了问题）。当进⾏数据清洗以进⾏分析时，最好直接对缺失数据进⾏分析，以判断数</span><br><span class="line">据采集的问题或缺失数据可能导致的偏差。</span><br><span class="line">Python内置的None值在对象数组中也可以作为NA：</span><br><span class="line">In [13]: string_data[0] = None</span><br><span class="line">In [14]: string_data.isnull()</span><br><span class="line">Out[14]:</span><br><span class="line">0 True</span><br><span class="line">1 False</span><br><span class="line">2 True</span><br><span class="line">3 False</span><br><span class="line">dtype: bool</span><br><span class="line">滤除缺失数据</span><br><span class="line">In [15]: from numpy import nan as NA</span><br><span class="line">In [16]: data = pd.Series([1, NA, 3.5, NA, 7])</span><br><span class="line">In [17]: data.dropna()</span><br><span class="line">Out[17]:</span><br><span class="line">0 1.0</span><br><span class="line">2 3.5</span><br><span class="line">4 7.0</span><br><span class="line">dtype: float64</span><br><span class="line">和这个效果⼀样</span><br><span class="line">In [18]: data[data.notnull()]</span><br><span class="line">Out[18]:</span><br><span class="line">0 1.0</span><br><span class="line">2 3.5</span><br><span class="line">4 7.0</span><br><span class="line">dtype: float64</span><br><span class="line">DataFrame对象，dropna默认丢弃任何含有缺失值的⾏</span><br><span class="line">In [19]: data = pd.DataFrame([[1., 6.5, 3.], [1., NA, NA],</span><br><span class="line"> ....: [NA, NA, NA], [NA, 6.5, 3.]])</span><br><span class="line">In [20]: cleaned = data.dropna()</span><br><span class="line">In [21]: data</span><br><span class="line">Out[21]:</span><br><span class="line"> 0 1 2</span><br><span class="line">0 1.0 6.5 3.0</span><br><span class="line">1 1.0 NaN NaN</span><br><span class="line">2 NaN NaN NaN</span><br><span class="line">3 NaN 6.5 3.0</span><br><span class="line">In [22]: cleaned</span><br><span class="line">Out[22]:</span><br><span class="line"> 0 1 2</span><br><span class="line">0 1.0 6.5 3.0</span><br><span class="line">传⼊how=‘all’将只丢弃全为NA的那些⾏</span><br><span class="line">In [23]: data.dropna(how=&apos;all&apos;)</span><br><span class="line">Out[23]:</span><br><span class="line"> 0 1 2</span><br><span class="line">0 1.0 6.5 3.0</span><br><span class="line">1 1.0 NaN NaN</span><br><span class="line">3 NaN 6.5 3.0</span><br><span class="line">In [24]: data[4] = NA</span><br><span class="line">In [25]: data</span><br><span class="line">Out[25]:</span><br><span class="line"> 0 1 2 4</span><br><span class="line">0 1.0 6.5 3.0 NaN</span><br><span class="line">1 1.0 NaN NaN NaN</span><br><span class="line">2 NaN NaN NaN NaN</span><br><span class="line">3 NaN 6.5 3.0 NaN</span><br><span class="line">In [26]: data.dropna(axis=1, how=&apos;all&apos;)</span><br><span class="line">Out[26]: </span><br><span class="line"> 0 1 2</span><br><span class="line">0 1.0 6.5 3.0</span><br><span class="line">1 1.0 NaN NaN</span><br><span class="line">2 NaN NaN NaN</span><br><span class="line">3 NaN 6.5 3.0</span><br><span class="line">In [27]: df = pd.DataFrame(np.random.randn(7, 3))</span><br><span class="line">In [28]: df.iloc[:4, 1] = NA</span><br><span class="line">In [29]: df.iloc[:2, 2] = NA</span><br><span class="line">In [30]: df</span><br><span class="line">Out[30]:</span><br><span class="line"> 0 1 2</span><br><span class="line">0 -0.204708 NaN NaN</span><br><span class="line">1 -0.555730 NaN NaN</span><br><span class="line">2 0.092908 NaN 0.769023</span><br><span class="line">3 1.246435 NaN -1.296221</span><br><span class="line">4 0.274992 0.228913 1.352917</span><br><span class="line">5 0.886429 -2.001637 -0.371843</span><br><span class="line">6 1.669025 -0.438570 -0.539741</span><br><span class="line">In [31]: df.dropna()</span><br><span class="line">Out[31]:</span><br><span class="line"> 0 1 2</span><br><span class="line">4 0.274992 0.228913 1.352917</span><br><span class="line">5 0.886429 -2.001637 -0.371843</span><br><span class="line">6 1.669025 -0.438570 -0.539741</span><br><span class="line"># 删除⼩于n个⾮空值的⾏</span><br><span class="line">In [32]: df.dropna(thresh=2)</span><br><span class="line">Out[32]:</span><br><span class="line"> 0 1 2</span><br><span class="line">2 0.092908 NaN 0.769023</span><br><span class="line">3 1.246435 NaN -1.296221</span><br><span class="line">4 0.274992 0.228913 1.352917</span><br><span class="line">5 0.886429 -2.001637 -0.371843</span><br><span class="line">6 1.669025 -0.438570 -0.539741</span><br><span class="line">填充缺失数据</span><br><span class="line">fillna⽅法是最主要的函数。通过⼀个常数调⽤fillna就会将缺失值替换为那个常数值</span><br><span class="line">In [33]: df.fillna(0)</span><br><span class="line">Out[33]:</span><br><span class="line"> 0 1 2</span><br><span class="line">0 -0.204708 0.000000 0.000000</span><br><span class="line">1 -0.555730 0.000000 0.000000</span><br><span class="line">2 0.092908 0.000000 0.769023</span><br><span class="line">3 1.246435 0.000000 -1.296221</span><br><span class="line">4 0.274992 0.228913 1.352917</span><br><span class="line">5 0.886429 -2.001637 -0.371843</span><br><span class="line">6 1.669025 -0.438570 -0.539741</span><br><span class="line">通过⼀个字典调⽤fillna，就可以实现对不同的列填充不同的值</span><br><span class="line">In [34]: df.fillna(&#123;1: 0.5, 2: 0&#125;)</span><br><span class="line">Out[34]:</span><br><span class="line"> 0 1 2</span><br><span class="line">0 -0.204708 0.500000 0.000000</span><br><span class="line">1 -0.555730 0.500000 0.000000</span><br><span class="line">2 0.092908 0.500000 0.769023</span><br><span class="line">3 1.246435 0.500000 -1.296221</span><br><span class="line">4 0.274992 0.228913 1.352917</span><br><span class="line">5 0.886429 -2.001637 -0.371843</span><br><span class="line">6 1.669025 -0.438570 -0.539741</span><br><span class="line">fillna默认会返回新对象，但也可以对现有对象进⾏就地修改</span><br><span class="line">In [35]: _ = df.fillna(0, inplace=True)</span><br><span class="line">In [36]: df</span><br><span class="line">Out[36]:</span><br><span class="line"> 0 1 2</span><br><span class="line">0 -0.204708 0.000000 0.000000</span><br><span class="line">1 -0.555730 0.000000 0.000000</span><br><span class="line">2 0.092908 0.000000 0.769023</span><br><span class="line">3 1.246435 0.000000 -1.296221</span><br><span class="line">4 0.274992 0.228913 1.352917</span><br><span class="line">5 0.886429 -2.001637 -0.371843</span><br><span class="line">6 1.669025 -0.438570 -0.539741</span><br><span class="line">对reindexing有效的那些插值⽅法也可⽤于fillna</span><br><span class="line">In [37]: df = pd.DataFrame(np.random.randn(6, 3))</span><br><span class="line">In [38]: df.iloc[2:, 1] = NA</span><br><span class="line">In [39]: df.iloc[4:, 2] = NA</span><br><span class="line">In [40]: df</span><br><span class="line">Out[40]:</span><br><span class="line"> 0 1 2</span><br><span class="line">0 0.476985 3.248944 -1.021228</span><br><span class="line">1 -0.577087 0.124121 0.302614</span><br><span class="line">2 0.523772 NaN 1.343810</span><br><span class="line">3 -0.713544 NaN -2.370232</span><br><span class="line">4 -1.860761 NaN NaN</span><br><span class="line">5 -1.265934 NaN NaN</span><br><span class="line">In [41]: df.fillna(method=&apos;ffill&apos;)</span><br><span class="line">Out[41]:</span><br><span class="line"> 0 1 2</span><br><span class="line">0 0.476985 3.248944 -1.021228</span><br><span class="line">1 -0.577087 0.124121 0.302614</span><br><span class="line">2 0.523772 0.124121 1.343810</span><br><span class="line">3 -0.713544 0.124121 -2.370232</span><br><span class="line">4 -1.860761 0.124121 -2.370232</span><br><span class="line">5 -1.265934 0.124121 -2.370232</span><br><span class="line">In [42]: df.fillna(method=&apos;ffill&apos;, limit=2)</span><br><span class="line">Out[42]:</span><br><span class="line"> 0 1 2</span><br><span class="line">0 0.476985 3.248944 -1.021228</span><br><span class="line">1 -0.577087 0.124121 0.302614</span><br><span class="line">2 0.523772 0.124121 1.343810</span><br><span class="line">3 -0.713544 0.124121 -2.370232</span><br><span class="line">4 -1.860761 NaN -2.370232</span><br><span class="line">5 -1.265934 NaN -2.370232</span><br><span class="line">传⼊Series的平均值或中位数</span><br><span class="line">In [43]: data = pd.Series([1., NA, 3.5, NA, 7])</span><br><span class="line">In [44]: data.fillna(data.mean())</span><br><span class="line">Out[44]:</span><br><span class="line">0 1.000000</span><br><span class="line">1 3.833333</span><br><span class="line">2 3.500000</span><br><span class="line">3 3.833333</span><br><span class="line">4 7.000000</span><br><span class="line">dtype: float64</span><br><span class="line">数据转换</span><br><span class="line">移除重复数据</span><br><span class="line">In [45]: data = pd.DataFrame(&#123;&apos;k1&apos;: [&apos;one&apos;, &apos;two&apos;] * 3 + [&apos;two&apos;],</span><br><span class="line"> ....: &apos;k2&apos;: [1, 1, 2, 3, 3, 4, 4]&#125;)</span><br><span class="line">In [46]: data</span><br><span class="line">Out[46]:</span><br><span class="line"> k1 k2</span><br><span class="line">0 one 1</span><br><span class="line">1 two 1</span><br><span class="line">2 one 2</span><br><span class="line">3 two 3</span><br><span class="line">4 one 3</span><br><span class="line">5 two 4</span><br><span class="line">6 two 4</span><br><span class="line">DataFrame的duplicated⽅法返回⼀个布尔型Series，表示各⾏是否是重复⾏</span><br><span class="line">In [47]: data.duplicated()</span><br><span class="line">Out[47]:</span><br><span class="line">0 False</span><br><span class="line">1 False</span><br><span class="line">2 False</span><br><span class="line">3 False</span><br><span class="line">4 False</span><br><span class="line">5 False</span><br><span class="line">6 True</span><br><span class="line">dtype: bool</span><br><span class="line">drop_duplicates⽅法，它会返回⼀个DataFrame，重复的数组会标为False</span><br><span class="line">In [48]: data.drop_duplicates()</span><br><span class="line">Out[48]:</span><br><span class="line"> k1 k2</span><br><span class="line">0 one 1</span><br><span class="line">1 two 1</span><br><span class="line">2 one 2</span><br><span class="line">3 two 3</span><br><span class="line">4 one 3</span><br><span class="line">5 two 4</span><br><span class="line">只希望根据k1列过滤重复项</span><br><span class="line">In [49]: data[&apos;v1&apos;] = range(7)</span><br><span class="line">In [50]: data.drop_duplicates([&apos;k1&apos;])</span><br><span class="line">Out[50]:</span><br><span class="line"> k1 k2 v1</span><br><span class="line">0 one 1 0</span><br><span class="line">1 two 1 1</span><br><span class="line">duplicated和drop_duplicates默认保留的是第⼀个出现的值组合。传⼊keep=‘last’则保留最</span><br><span class="line">后⼀个</span><br><span class="line">In [51]: data.drop_duplicates([&apos;k1&apos;, &apos;k2&apos;], keep=&apos;last&apos;)</span><br><span class="line">Out[51]:</span><br><span class="line"> k1 k2 v1</span><br><span class="line">0 one 1 0</span><br><span class="line">1 two 1 1</span><br><span class="line">2 one 2 2</span><br><span class="line">3 two 3 3</span><br><span class="line">4 one 3 4</span><br><span class="line">6 two 4 6</span><br><span class="line">利⽤函数或映射进⾏数据转换</span><br><span class="line">根据数组、Series或DataFrame列中的值来实现转换⼯作</span><br><span class="line">In [52]: data = pd.DataFrame(&#123;&apos;food&apos;: [&apos;bacon&apos;, &apos;pulled pork&apos;, &apos;bacon&apos;,</span><br><span class="line"> ....: &apos;Pastrami&apos;, &apos;corned beef&apos;, &apos;Bacon&apos;,</span><br><span class="line"> ....: &apos;pastrami&apos;, &apos;honey ham&apos;, &apos;nova lox&apos;],</span><br><span class="line"> ....: &apos;ounces&apos;: [4, 3, 12, 6, 7.5, 8, 3, 5, 6]&#125;)</span><br><span class="line">In [53]: data</span><br><span class="line">Out[53]:</span><br><span class="line"> food ounces</span><br><span class="line">0 bacon 4.0</span><br><span class="line">1 pulled pork 3.0</span><br><span class="line">2 bacon 12.0</span><br><span class="line">3 Pastrami 6.0</span><br><span class="line">4 corned beef 7.5</span><br><span class="line">5 Bacon 8.0</span><br><span class="line">6 pastrami 3.0</span><br><span class="line">7 honey ham 5.0</span><br><span class="line">8 nova lox 6.0</span><br><span class="line">添加⼀列表示该⾁类⻝物来源的动物类型。我们先编写⼀个不同⾁类到动物的映射</span><br><span class="line">meat_to_animal = &#123;</span><br><span class="line"> &apos;bacon&apos;: &apos;pig&apos;,</span><br><span class="line"> &apos;pulled pork&apos;: &apos;pig&apos;,</span><br><span class="line"> &apos;pastrami&apos;: &apos;cow&apos;,</span><br><span class="line"> &apos;corned beef&apos;: &apos;cow&apos;,</span><br><span class="line"> &apos;honey ham&apos;: &apos;pig&apos;,</span><br><span class="line"> &apos;nova lox&apos;: &apos;salmon&apos;</span><br><span class="line">&#125;</span><br><span class="line">使⽤Series的str.lower⽅法，将各个值转换为⼩写</span><br><span class="line">In [55]: lowercased = data[&apos;food&apos;].str.lower()</span><br><span class="line">In [56]: lowercased</span><br><span class="line">Out[56]:</span><br><span class="line">0 bacon</span><br><span class="line">1 pulled pork</span><br><span class="line">2 bacon</span><br><span class="line">3 pastrami</span><br><span class="line">4 corned beef</span><br><span class="line">5 bacon</span><br><span class="line">6 pastrami</span><br><span class="line">7 honey ham</span><br><span class="line">8 nova lox</span><br><span class="line">Name: food, dtype: object</span><br><span class="line">In [57]: data[&apos;animal&apos;] = lowercased.map(meat_to_animal)</span><br><span class="line">In [58]: data</span><br><span class="line">Out[58]:</span><br><span class="line"> food ounces animal</span><br><span class="line">0 bacon 4.0 pig</span><br><span class="line">1 pulled pork 3.0 pig</span><br><span class="line">2 bacon 12.0 pig</span><br><span class="line">3 Pastrami 6.0 cow</span><br><span class="line">4 corned beef 7.5 cow</span><br><span class="line">5 Bacon 8.0 pig</span><br><span class="line">6 pastrami 3.0 cow</span><br><span class="line">7 honey ham 5.0 pig</span><br><span class="line">8 nova lox 6.0 salmon</span><br><span class="line">也可以传⼊⼀个能够完成全部这些⼯作的函数</span><br><span class="line">In [59]: data[&apos;food&apos;].map(lambda x: meat_to_animal[x.lower()])</span><br><span class="line">Out[59]:</span><br><span class="line">0 pig</span><br><span class="line">1 pig</span><br><span class="line">2 pig</span><br><span class="line">3 cow</span><br><span class="line">4 cow</span><br><span class="line">5 pig</span><br><span class="line">6 cow</span><br><span class="line">7 pig</span><br><span class="line">8 salmon</span><br><span class="line">Name: food, dtype: object</span><br><span class="line">替换值</span><br><span class="line">In [60]: data = pd.Series([1., -999., 2., -999., -1000., 3.])</span><br><span class="line">In [61]: data</span><br><span class="line">Out[61]:</span><br><span class="line">0 1.0</span><br><span class="line">1 -999.0</span><br><span class="line">2 2.0</span><br><span class="line">3 -999.0</span><br><span class="line">4 -1000.0</span><br><span class="line">5 3.0</span><br><span class="line">-999这个值可能是⼀个表示缺失数据的标记值。要将其替换为pandas能够理解的NA值</span><br><span class="line">In [62]: data.replace(-999, np.nan)</span><br><span class="line">Out[62]:</span><br><span class="line">0 1.0</span><br><span class="line">1 NaN</span><br><span class="line">2 2.0</span><br><span class="line">3 NaN</span><br><span class="line">4 -1000.0</span><br><span class="line">5 3.0</span><br><span class="line">dtype: float64</span><br><span class="line">⼀次性替换多个值</span><br><span class="line">In [63]: data.replace([-999, -1000], np.nan)</span><br><span class="line">Out[63]:</span><br><span class="line">0 1.0</span><br><span class="line">1 NaN</span><br><span class="line">2 2.0</span><br><span class="line">3 NaN</span><br><span class="line">4 NaN</span><br><span class="line">5 3.0</span><br><span class="line">dtype: float64</span><br><span class="line">让每个值有不同的替换值，可以传递⼀个替换列表</span><br><span class="line">In [64]: data.replace([-999, -1000], [np.nan, 0])</span><br><span class="line">Out[64]:</span><br><span class="line">0 1.0</span><br><span class="line">1 NaN</span><br><span class="line">2 2.0</span><br><span class="line">3 NaN</span><br><span class="line">4 0.0</span><br><span class="line">5 3.0</span><br><span class="line">dtype: float64</span><br><span class="line">In [65]: data.replace(&#123;-999: np.nan, -1000: 0&#125;)</span><br><span class="line">Out[65]:</span><br><span class="line">0 1.0</span><br><span class="line">1 NaN</span><br><span class="line">2 2.0</span><br><span class="line">3 NaN</span><br><span class="line">4 0.0</span><br><span class="line">5 3.0</span><br><span class="line">dtype: float64</span><br><span class="line">重命名轴索引</span><br><span class="line">In [66]: data = pd.DataFrame(np.arange(12).reshape((3, 4)),</span><br><span class="line"> ....: index=[&apos;Ohio&apos;, &apos;Colorado&apos;, &apos;New York&apos;],</span><br><span class="line"> ....: columns=[&apos;one&apos;, &apos;two&apos;, &apos;three&apos;, &apos;four&apos;])</span><br><span class="line">In [67]: transform = lambda x: x[:4].upper()</span><br><span class="line">In [68]: data.index.map(transform)</span><br><span class="line">Out[68]: Index([&apos;OHIO&apos;, &apos;COLO&apos;, &apos;NEW &apos;], dtype=&apos;object&apos;)</span><br><span class="line">In [69]: data.index = data.index.map(transform)</span><br><span class="line">In [70]: data</span><br><span class="line">Out[70]:</span><br><span class="line">one two three four</span><br><span class="line">OHIO 0 1 2 3</span><br><span class="line">COLO 4 5 6 7</span><br><span class="line">NEW 8 9 10 11</span><br><span class="line">如果想要创建数据集的转换版（⽽不是修改原始数据）</span><br><span class="line">In [71]: data.rename(index=str.title, columns=str.upper)</span><br><span class="line">Out[71]:</span><br><span class="line"> ONE TWO THREE FOUR</span><br><span class="line">Ohio 0 1 2 3</span><br><span class="line">Colo 4 5 6 7</span><br><span class="line">New 8 9 10 11</span><br><span class="line">rename可以结合字典型对象实现对部分轴标签的更新</span><br><span class="line">In [72]: data.rename(index=&#123;&apos;OHIO&apos;: &apos;INDIANA&apos;&#125;,</span><br><span class="line"> ....: columns=&#123;&apos;three&apos;: &apos;peekaboo&apos;&#125;)</span><br><span class="line">Out[72]:</span><br><span class="line">one two peekaboo four</span><br><span class="line">INDIANA 0 1 2 3</span><br><span class="line">COLO 4 5 6 7</span><br><span class="line">NEW 8 9 10 11</span><br><span class="line">就地修改某个数据集，传⼊inplace=True即可</span><br><span class="line">In [73]: data.rename(index=&#123;&apos;OHIO&apos;: &apos;INDIANA&apos;&#125;, inplace=True)</span><br><span class="line">In [74]: data</span><br><span class="line">Out[74]:</span><br><span class="line"> one two three four</span><br><span class="line">INDIANA 0 1 2 3</span><br><span class="line">COLO 4 5 6 7</span><br><span class="line">NEW 8 9 10 11</span><br><span class="line">离散化和⾯元划分</span><br><span class="line">为了便于分析，连续数据常常被离散化或拆分为“⾯元”（bin）。假设有⼀组⼈员数据，⽽你</span><br><span class="line">希望将它们划分为不同的年龄组</span><br><span class="line">In [75]: ages = [20, 22, 25, 27, 21, 23, 37, 31, 61, 45, 41, 32]</span><br><span class="line">将这些数据划分为“18到25”、“26到35”、“35到60”以及“60以上”⼏个⾯元</span><br><span class="line">In [76]: bins = [18, 25, 35, 60, 100]</span><br><span class="line">In [77]: cats = pd.cut(ages, bins)</span><br><span class="line">In [78]: cats</span><br><span class="line">Out[78]:</span><br><span class="line">[(18, 25], (18, 25], (18, 25], (25, 35], (18, 25], ..., (25, 35], (60, 100],</span><br><span class="line">(35,60], (35, 60], (25, 35]]</span><br><span class="line">Length: 12</span><br><span class="line">Categories (4, interval[int64]): [(18, 25] &lt; (25, 35] &lt; (35, 60] &lt; (60, 100]]</span><br><span class="line">pandas返回的是⼀个特殊的Categorical对象。结果展示了pandas.cut划分的⾯元。你可以将</span><br><span class="line">其看做⼀组表示⾯元名称的字符串</span><br><span class="line">In [79]: cats.codes</span><br><span class="line">Out[79]: array([0, 0, 0, 1, 0, 0, 2, 1, 3, 2, 2, 1], dtype=int8)</span><br><span class="line">In [80]: cats.categories</span><br><span class="line">Out[80]:</span><br><span class="line">IntervalIndex([(18, 25], (25, 35], (35, 60], (60, 100]]</span><br><span class="line"> closed=&apos;right&apos;,</span><br><span class="line"> dtype=&apos;interval[int64]&apos;)</span><br><span class="line"># ⾯元计数</span><br><span class="line">In [81]: pd.value_counts(cats)</span><br><span class="line">Out[81]:</span><br><span class="line">(18, 25] 5</span><br><span class="line">(35, 60] 3</span><br><span class="line">(25, 35] 3</span><br><span class="line">(60, 100] 1</span><br><span class="line">dtype: int64</span><br><span class="line">跟“区间”的数学符号⼀样，圆括号表示开端，⽽⽅括号则表示闭端（包括）。哪边是闭端可以</span><br><span class="line">通过right=False进⾏修改</span><br><span class="line">In [82]: pd.cut(ages, [18, 26, 36, 61, 100], right=False)</span><br><span class="line">Out[82]:</span><br><span class="line">[[18, 26), [18, 26), [18, 26), [26, 36), [18, 26), ..., [26, 36), [61, 100),</span><br><span class="line">[36,</span><br><span class="line"> 61), [36, 61), [26, 36)]</span><br><span class="line">Length: 12</span><br><span class="line">Categories (4, interval[int64]): [[18, 26) &lt; [26, 36) &lt; [36, 61) &lt; [61, 100)]</span><br><span class="line">通过传递⼀个列表或数组到labels，设置⾯元名称</span><br><span class="line">In [83]: group_names = [&apos;Youth&apos;, &apos;YoungAdult&apos;, &apos;MiddleAged&apos;, &apos;Senior&apos;]</span><br><span class="line">In [84]: pd.cut(ages, bins, labels=group_names)</span><br><span class="line">Out[84]:</span><br><span class="line">[Youth, Youth, Youth, YoungAdult, Youth, ..., YoungAdult, Senior, MiddleAged,</span><br><span class="line">Mid</span><br><span class="line">dleAged, YoungAdult]</span><br><span class="line">Length: 12</span><br><span class="line">Categories (4, object): [Youth &lt; YoungAdult &lt; MiddleAged &lt; Senior]</span><br><span class="line">向cut传⼊的是⾯元的数量⽽不是确切的⾯元边界，则它会根据数据的最⼩值和最⼤值计算等</span><br><span class="line">⻓⾯元。下⾯这个例⼦中，我们将⼀些均匀分布的数据分成四组，选项precision=2，限定⼩</span><br><span class="line">数只有两位</span><br><span class="line">In [85]: data = np.random.rand(20)</span><br><span class="line">In [86]: pd.cut(data, 4, precision=2)</span><br><span class="line">Out[86]:</span><br><span class="line">[(0.34, 0.55], (0.34, 0.55], (0.76, 0.97], (0.76, 0.97], (0.34, 0.55], ...,</span><br><span class="line">(0.34</span><br><span class="line">, 0.55], (0.34, 0.55], (0.55, 0.76], (0.34, 0.55], (0.12, 0.34]]</span><br><span class="line">Length: 20</span><br><span class="line">Categories (4, interval[float64]): [(0.12, 0.34] &lt; (0.34, 0.55] &lt; (0.55, 0.76]</span><br><span class="line">&lt;</span><br><span class="line">(0.76, 0.97]]</span><br><span class="line">qcut是⼀个⾮常类似于cut的函数，它可以根据样本分位数对数据进⾏⾯元划分。</span><br><span class="line">In [87]: data = np.random.randn(1000) # Normally distributed</span><br><span class="line">In [88]: cats = pd.qcut(data, 4) # Cut into quartiles</span><br><span class="line">In [89]: cats</span><br><span class="line">Out[89]:</span><br><span class="line">[(-0.0265, 0.62], (0.62, 3.928], (-0.68, -0.0265], (0.62, 3.928], (-0.0265,</span><br><span class="line">0.62]</span><br><span class="line">, ..., (-0.68, -0.0265], (-0.68, -0.0265], (-2.95, -0.68], (0.62, 3.928],</span><br><span class="line">(-0.68,</span><br><span class="line"> -0.0265]]</span><br><span class="line">Length: 1000</span><br><span class="line">Categories (4, interval[float64]): [(-2.95, -0.68] &lt; (-0.68, -0.0265] &lt;</span><br><span class="line">(-0.0265,</span><br><span class="line"> 0.62] &lt;</span><br><span class="line"> (0.62, 3.928]]</span><br><span class="line">In [90]: pd.value_counts(cats)</span><br><span class="line">Out[90]:</span><br><span class="line">(0.62, 3.928] 250</span><br><span class="line">(-0.0265, 0.62] 250</span><br><span class="line">(-0.68, -0.0265] 250</span><br><span class="line">(-2.95, -0.68] 250</span><br><span class="line">dtype: int64</span><br><span class="line">检测和过滤异常值</span><br><span class="line">In [92]: data = pd.DataFrame(np.random.randn(1000, 4))</span><br><span class="line">In [93]: data.describe()</span><br><span class="line">Out[93]:</span><br><span class="line"> 0 1 2 3</span><br><span class="line">count 1000.000000 1000.000000 1000.000000 1000.000000</span><br><span class="line">mean 0.049091 0.026112 -0.002544 -0.051827</span><br><span class="line">std 0.996947 1.007458 0.995232 0.998311</span><br><span class="line">min -3.645860 -3.184377 -3.745356 -3.428254</span><br><span class="line">25% -0.599807 -0.612162 -0.687373 -0.747478</span><br><span class="line">50% 0.047101 -0.013609 -0.022158 -0.088274</span><br><span class="line">75% 0.756646 0.695298 0.699046 0.623331</span><br><span class="line">max 2.653656 3.525865 2.735527 3.366626</span><br><span class="line">某列中绝对值⼤⼩超过3的值</span><br><span class="line">In [94]: col = data[2]</span><br><span class="line">In [95]: col[np.abs(col) &gt; 3]</span><br><span class="line">Out[95]:</span><br><span class="line">41 -3.399312</span><br><span class="line">136 -3.745356</span><br><span class="line">Name: 2, dtype: float64</span><br><span class="line">选出全部含有“超过3或－3的值”的⾏</span><br><span class="line">In [96]: data[(np.abs(data) &gt; 3).any(1)]</span><br><span class="line">Out[96]:</span><br><span class="line"> 0 1 2 3</span><br><span class="line">41 0.457246 -0.025907 -3.399312 -0.974657</span><br><span class="line">60 1.951312 3.260383 0.963301 1.201206</span><br><span class="line">136 0.508391 -0.196713 -3.745356 -1.520113</span><br><span class="line">235 -0.242459 -3.056990 1.918403 -0.578828</span><br><span class="line">258 0.682841 0.326045 0.425384 -3.428254</span><br><span class="line">322 1.179227 -3.184377 1.369891 -1.074833</span><br><span class="line">544 -3.548824 1.553205 -2.186301 1.277104</span><br><span class="line">635 -0.578093 0.193299 1.397822 3.366626</span><br><span class="line">782 -0.207434 3.525865 0.283070 0.544635</span><br><span class="line">803 -3.645860 0.255475 -0.549574 -1.907459</span><br><span class="line">np.sign(data)可以⽣成1和-1</span><br><span class="line">In [99]: np.sign(data).head()</span><br><span class="line">Out[99]:</span><br><span class="line"> 0 1 2 3</span><br><span class="line">0 -1.0 1.0 -1.0 1.0</span><br><span class="line">1 1.0 -1.0 1.0 -1.0</span><br><span class="line">2 1.0 1.0 1.0 -1.0</span><br><span class="line">3 -1.0 -1.0 1.0 -1.0</span><br><span class="line">4 -1.0 1.0 -1.0 -1.0</span><br><span class="line">排列和随机采样</span><br><span class="line">利⽤numpy.random.permutation函数可以轻松实现对Series或DataFrame的列的排列⼯作</span><br><span class="line">（permuting，随机重排序）</span><br><span class="line">In [100]: df = pd.DataFrame(np.arange(20).reshape((5, 4)))</span><br><span class="line">In [101]: sampler = np.random.permutation(5)</span><br><span class="line">In [102]: sampler</span><br><span class="line">Out[102]: array([3, 1, 4, 2, 0])</span><br><span class="line">In [103]: df</span><br><span class="line">Out[103]:</span><br><span class="line"> 0 1 2 3</span><br><span class="line">0 0 1 2 3</span><br><span class="line">1 4 5 6 7</span><br><span class="line">2 8 9 10 11</span><br><span class="line">3 12 13 14 15</span><br><span class="line">4 16 17 18 19</span><br><span class="line">In [104]: df.take(sampler)</span><br><span class="line">Out[104]:</span><br><span class="line"> 0 1 2 3</span><br><span class="line">3 12 13 14 15</span><br><span class="line">1 4 5 6 7</span><br><span class="line">4 16 17 18 19</span><br><span class="line">2 8 9 10 11</span><br><span class="line">0 0 1 2 3</span><br><span class="line">In [105]: df.sample(n=3)</span><br><span class="line">Out[105]:</span><br><span class="line"> 0 1 2 3</span><br><span class="line">3 12 13 14 15</span><br><span class="line">4 16 17 18 19</span><br><span class="line">2 8 9 10 11</span><br><span class="line">要通过替换的⽅式产⽣样本（允许重复选择），可以传递replace=True到sample</span><br><span class="line">In [106]: choices = pd.Series([5, 7, -1, 6, 4])</span><br><span class="line">In [107]: draws = choices.sample(n=10, replace=True)</span><br><span class="line">In [108]: draws</span><br><span class="line">Out[108]:</span><br><span class="line">4 4</span><br><span class="line">1 7</span><br><span class="line">4 4</span><br><span class="line">2 -1</span><br><span class="line">0 5</span><br><span class="line">3 6</span><br><span class="line">1 7</span><br><span class="line">4 4</span><br><span class="line">0 5</span><br><span class="line">4 4</span><br><span class="line">dtype: int64</span><br><span class="line">计算指标/哑变量</span><br><span class="line">将分类变量（categorical variable）转换为“哑变量”或“指标矩阵”</span><br><span class="line">In [109]: df = pd.DataFrame(&#123;&apos;key&apos;: [&apos;b&apos;, &apos;b&apos;, &apos;a&apos;, &apos;c&apos;, &apos;a&apos;, &apos;b&apos;],</span><br><span class="line"> .....: &apos;data1&apos;: range(6)&#125;)</span><br><span class="line">In [110]: pd.get_dummies(df[&apos;key&apos;])</span><br><span class="line">Out[110]:</span><br><span class="line"> a b c</span><br><span class="line">0 0 1 0</span><br><span class="line">1 0 1 0</span><br><span class="line">2 1 0 0</span><br><span class="line">3 0 0 1</span><br><span class="line">4 1 0 0</span><br><span class="line">5 0 1 0</span><br><span class="line">In [111]: dummies = pd.get_dummies(df[&apos;key&apos;], prefix=&apos;key&apos;)</span><br><span class="line">In [112]: df_with_dummy = df[[&apos;data1&apos;]].join(dummies)</span><br><span class="line">In [113]: df_with_dummy</span><br><span class="line">Out[113]:</span><br><span class="line"> data1 key_a key_b key_c</span><br><span class="line">0 0 0 1 0</span><br><span class="line">1 1 0 1 0</span><br><span class="line">2 2 1 0 0</span><br><span class="line">3 3 0 0 1</span><br><span class="line">4 4 1 0 0</span><br><span class="line">5 5 0 1 0</span><br><span class="line">In [114]: mnames = [&apos;movie_id&apos;, &apos;title&apos;, &apos;genres&apos;]</span><br><span class="line">In [115]: movies = pd.read_table(&apos;datasets/movielens/movies.dat&apos;, sep=&apos;::&apos;,</span><br><span class="line"> .....: header=None, names=mnames, engine=&apos;python&apos;)</span><br><span class="line">In [116]: movies[:10]</span><br><span class="line">Out[116]:</span><br><span class="line"> movie_id title genres</span><br><span class="line">0 1 Toy Story (1995) Animation|Children&apos;s|Comedy</span><br><span class="line">1 2 Jumanji (1995) Adventure|Children&apos;s|Fantasy</span><br><span class="line">2 3 Grumpier Old Men (1995) Comedy|Romance</span><br><span class="line">3 4 Waiting to Exhale (1995) Comedy|Drama</span><br><span class="line">4 5 Father of the Bride Part II (1995) Comedy</span><br><span class="line">5 6 Heat (1995) Action|Crime|Thriller</span><br><span class="line">6 7 Sabrina (1995) Comedy|Romance</span><br><span class="line">7 8 Tom and Huck (1995) Adventure|Children&apos;s</span><br><span class="line">8 9 Sudden Death (1995)</span><br><span class="line">Action</span><br><span class="line">9 10 GoldenEye (1995) Action|Adventure|Thriller</span><br><span class="line">In [117]: all_genres = []</span><br><span class="line">In [118]: for x in movies.genres:</span><br><span class="line"> .....: all_genres.extend(x.split(&apos;|&apos;))</span><br><span class="line">In [119]: genres = pd.unique(all_genres)</span><br><span class="line">构建指标DataFrame的⽅法之⼀是从⼀个全零DataFrame开始</span><br><span class="line">In [121]: zero_matrix = np.zeros((len(movies), len(genres)))</span><br><span class="line">In [122]: dummies = pd.DataFrame(zero_matrix, columns=genres)</span><br><span class="line">pandas的⽮量化字符串函数</span><br><span class="line">In [167]: data = &#123;&apos;Dave&apos;: &apos;dave@google.com&apos;, &apos;Steve&apos;: &apos;steve@gmail.com&apos;,</span><br><span class="line"> .....: &apos;Rob&apos;: &apos;rob@gmail.com&apos;, &apos;Wes&apos;: np.nan&#125;</span><br><span class="line">In [168]: data = pd.Series(data)</span><br><span class="line">In [169]: data</span><br><span class="line">Out[169]:</span><br><span class="line">Dave dave@google.com</span><br><span class="line">Rob rob@gmail.com</span><br><span class="line">Steve steve@gmail.com</span><br><span class="line">Wes NaN</span><br><span class="line">dtype: object</span><br><span class="line">In [170]: data.isnull()</span><br><span class="line">Out[170]:</span><br><span class="line">Dave False</span><br><span class="line">Rob False</span><br><span class="line">Steve False</span><br><span class="line">Wes True</span><br><span class="line">dtype: bool</span><br><span class="line">通过data.map，所有字符串和正则表达式⽅法都能被应⽤于（传⼊lambda表达式或其他函</span><br><span class="line">数）各个值，但是如果存在NA（null）就会报错。为了解决这个问题，Series有⼀些能够跳过</span><br><span class="line">NA值的⾯向数组⽅法，进⾏字符串操作。通过Series的str属性即可访问这些⽅法。例如，我</span><br><span class="line">们可以通过str.contains检查各个电⼦邮件地址是否含有&quot;gmail&quot;：</span><br><span class="line">In [171]: data.str.contains(&apos;gmail&apos;)</span><br><span class="line">Out[171]:</span><br><span class="line">Dave False</span><br><span class="line">Rob True</span><br><span class="line">Steve True</span><br><span class="line">Wes NaN</span><br><span class="line">dtype: object</span><br><span class="line">也可以使⽤正则表达式，还可以加上任意re选项（如IGNORECASE）</span><br><span class="line">import re</span><br><span class="line">pattern = r&apos;([A-Z0-9._%+-]+)@([A-Z0-9.-]+)\.([A-Z]&#123;2,4&#125;)&apos;</span><br><span class="line">In [172]: pattern</span><br><span class="line">Out[172]: &apos;([A-Z0-9._%+-]+)@([A-Z0-9.-]+)\\.([A-Z]&#123;2,4&#125;)&apos;</span><br><span class="line">In [173]: data.str.findall(pattern, flags=re.IGNORECASE)</span><br><span class="line">Out[173]:</span><br><span class="line">Dave [(dave, google, com)]</span><br><span class="line">Rob [(rob, gmail, com)]</span><br><span class="line">Steve [(steve, gmail, com)]</span><br><span class="line">Wes NaN</span><br><span class="line">dtype: object</span><br><span class="line">In [174]: matches = data.str.match(pattern, flags=re.IGNORECASE)</span><br><span class="line">In [175]: matches</span><br><span class="line">Out[175]:</span><br><span class="line">Dave True</span><br><span class="line">Rob True</span><br><span class="line">Steve True</span><br><span class="line">Wes NaN</span><br><span class="line">dtype: object</span><br><span class="line">字符串进⾏截取</span><br><span class="line">In [178]: data.str[:5]</span><br><span class="line">Out[178]:</span><br><span class="line">Dave dave@</span><br><span class="line">Rob rob@g</span><br><span class="line">Steve steve</span><br><span class="line">Wes NaN</span><br><span class="line">dtype: object</span><br></pre></td></tr></table></figure></p>

            </div>

            <!-- Post Comments -->
            

        </div>
        <!-- Copyright 版权 start -->
                <div id="copyright">
            <ul>
                <li>&copy;Powered By <a href="https://hexo.io/zh-cn/" style="border-bottom: none;">hexo</a></li>
                <li>Design: <a href="http://miccall.tech " style="border-bottom: none;">miccall</a></li>
            </ul>
            
                <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
			
        </div>
    </div>
</body>



 	
</html>
