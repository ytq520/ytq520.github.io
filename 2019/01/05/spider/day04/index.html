<!DOCTYPE HTML>
<html>

<head><meta name="generator" content="Hexo 3.8.0">
	<link rel="bookmark" type="image/x-icon" href="/img/logo_miccall.png">
	<link rel="shortcut icon" href="/img/logo_miccall.png">
	
			    <title>
    ytq520
    </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link rel="stylesheet" href="/css/mic_main.css">
    <link rel="stylesheet" href="/css/dropdownMenu.css">
    <meta name="keywords" content="miccall">
    
    	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	 
    <noscript>
        <link rel="stylesheet" href="/css/noscript.css">
    </noscript>
    <style type="text/css">
        body:before {
          content: ' ';
          position: fixed;
          top: 0;
          background: url('/img/bg.jpg') center 0 no-repeat;
          right: 0;
          bottom: 0;
          left: 0;
          background-size: cover; 
        }
    </style>

			    
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script async type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.scrollex.min.js"></script>
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/skel.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
	
</head>
    
		
<!-- Layouts -->



<!--  代码渲染  -->
<link rel="stylesheet" href="/css/prism_coy.css">
<link rel="stylesheet" href="/css/typo.css">
<!-- 文章页 -->
<body class="is-loading">
    <!-- Wrapper 外包 s-->
    <div id="wrapper" class="fade-in">
        <!-- Intro 头部显示 s -->
        <!-- Intro 头部显示 e -->
        <!-- Header 头部logo start -->
        <header id="header">
    <a href="/" class="logo">ytq520</a>
</header>
        <!-- Nav 导航条 start -->
        <nav id="nav" class="special">
            <ul class="menu links">
			<!-- Homepage  主页  --> 
			<li>
	            <a href="/" rel="nofollow">主页</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">分类</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="category-link" href="/categories/Data-Analysis/">Data Analysis</a></li><li><a class="category-link" href="/categories/Django/">Django</a></li><li><a class="category-link" href="/categories/Flask/">Flask</a></li><li><a class="category-link" href="/categories/JavaScript/">JavaScript</a></li><li><a class="category-link" href="/categories/MySQL/">MySQL</a></li><li><a class="category-link" href="/categories/html/">html</a></li><li><a class="category-link" href="/categories/python基础/">python基础</a></li><li><a class="category-link" href="/categories/spider/">spider</a>
	                    </li></ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/gallery/" title="图库">
		                图库
		            </a>
		        </li>
		        
		        <li>
		            <a href="/tag/" title="标签">
		                标签
		            </a>
		        </li>
		        


            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
                    
                    <li>
                        <a title="github" href="https://github.com/ytq520" target="_blank" rel="noopener">
                            <i class="icon fa fa-github"></i>
                        </a>
                    </li>
                    
                    <li>
                        <a title="500px" href="http://500px.com" target="_blank" rel="noopener">
                            <i class="icon fa fa-500px"></i>
                        </a>
                    </li>
                    
			</ul>
</nav>

        <div id="main">
            <div class="post_page_title_img" style="height: 25rem;background-image: url(/images/thumbs/15.jpg);background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;">
                <a href="#" style="padding: 4rem 4rem 2rem 4rem ;"><h2>selenium自动化爬取京东和虾米音乐，网易云音乐</h2></a>
            </div>
            <!-- Post -->
            <div class="typo" style="padding: 3rem;">
                <p>###用selenium音乐<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line"></span><br><span class="line">from selenium import webdriver</span><br><span class="line">from selenium.webdriver.common.by import By</span><br><span class="line">from selenium.webdriver.support.ui import WebDriverWait</span><br><span class="line">from selenium.webdriver.support import expected_conditions as EC</span><br><span class="line">from lxml import etree</span><br><span class="line">from sqlalchemy import create_engine</span><br><span class="line">from sqlalchemy.orm import sessionmaker</span><br><span class="line">from models import Jingdong</span><br><span class="line"></span><br><span class="line"># 保存数据库</span><br><span class="line">engine = create_engine(&quot;mysql+pymysql://root:123456@127.0.0.1/jd?charset=utf8&quot;, max_overflow=5)</span><br><span class="line">session_maker = sessionmaker(bind=engine)</span><br><span class="line">session = session_maker()</span><br><span class="line"></span><br><span class="line"># 打开一个浏览器</span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"># 设置等待时间</span><br><span class="line">wait = WebDriverWait(browser, 5)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_page(page):</span><br><span class="line">    if page == 1:</span><br><span class="line">        url = &apos;https://www.jd.com/&apos;</span><br><span class="line">        # 访问网址</span><br><span class="line">        browser.get(url)</span><br><span class="line">        input = wait.until(EC.presence_of_element_located((By.CSS_SELECTOR, &apos;#key&apos;)))</span><br><span class="line">        input.clear()</span><br><span class="line">        input.send_keys(&apos;女士夏装&apos;)</span><br><span class="line">        button = wait.until(EC.element_to_be_clickable((By.CSS_SELECTOR, &apos;#search button.button&apos;)))</span><br><span class="line">        button.click()</span><br><span class="line">        # 睡眠时间</span><br><span class="line">        time.sleep(5)</span><br><span class="line"></span><br><span class="line">    # 滑动到页面底部</span><br><span class="line">    str_js = &apos;var scrollHeight = document.body.scrollHeight;window.scrollTo(0, scrollHeight);&apos;</span><br><span class="line">    browser.execute_script(str_js)</span><br><span class="line">    time.sleep(2)</span><br><span class="line">    # for i in range(16):</span><br><span class="line">    #     i = i+1</span><br><span class="line">    #     str_js = &apos;var scrollHeight = document.body.scrollHeight / 16;window.scrollTo(0, scrollHeight * (%d));&apos; % i</span><br><span class="line">    #     browser.execute_script(str_js)</span><br><span class="line">    #     time.sleep(1)</span><br><span class="line">    # 向上翻页</span><br><span class="line">    for i in range(16, 0, -1):</span><br><span class="line">        str_js = &apos;var scrollHeight = document.body.scrollHeight / 16;window.scrollTo(0, scrollHeight * (%d));&apos; % i</span><br><span class="line">        browser.execute_script(str_js)</span><br><span class="line">        time.sleep(4)</span><br><span class="line">    # 保存当前页的内容</span><br><span class="line">    page_source = browser.page_source</span><br><span class="line"></span><br><span class="line">    # 向上滚动页面</span><br><span class="line">    input = browser.find_element_by_css_selector(&apos;#J_bottomPage input.input-txt&apos;)</span><br><span class="line">    str_js = &apos;var scrollHeight = document.body.scrollHeight;window.scrollTo(0, %d);&apos; % input.location[&apos;y&apos;]</span><br><span class="line">    browser.execute_script(str_js)</span><br><span class="line">    time.sleep(4)</span><br><span class="line">    # 输入页面码</span><br><span class="line">    input = wait.until(EC.presence_of_element_located((By.CSS_SELECTOR, &apos;#J_bottomPage input.input-txt&apos;)))</span><br><span class="line">    input.clear()</span><br><span class="line">    input.send_keys(page+1)</span><br><span class="line">    # 点击图片</span><br><span class="line">    submit = wait.until(EC.element_to_be_clickable((By.CSS_SELECTOR, &apos;#J_bottomPage .btn.btn-default&apos;)))</span><br><span class="line">    submit.click()</span><br><span class="line">    return page_source</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def parse_page(html):</span><br><span class="line">    etree_html = etree.HTML(html)</span><br><span class="line">    gl_items = etree_html.xpath(&apos;//div[@id=&quot;J_goodsList&quot;]//li[@class=&quot;gl-item&quot;]&apos;)</span><br><span class="line">    print(len(gl_items))</span><br><span class="line">    for gl_item in gl_items:</span><br><span class="line">        img_src = &apos;&apos;.join(gl_item.xpath(&apos;.//div[@class=&quot;p-img&quot;]/a/img/@src&apos;))</span><br><span class="line">        title = &apos;&apos;.join(gl_item.xpath(&apos;.//div[@class=&quot;p-name p-name-type-2&quot;]//em//text()&apos;))</span><br><span class="line">        price = &apos;&apos;.join(gl_item.xpath(&apos;.//div[@class=&quot;p-price&quot;]//strong//text()&apos;))</span><br><span class="line">        shop = &apos;&apos;.join(gl_item.xpath(&apos;.//div[@class=&quot;p-shop&quot;]//span/a/text()&apos;))</span><br><span class="line">        commit = &apos;&apos;.join(gl_item.xpath(&apos;.//div[@class=&quot;p-commit&quot;]//strong//text()&apos;))</span><br><span class="line">        icon = &apos;&apos;.join(gl_item.xpath(&apos;.//div[@class=&quot;p-icons&quot;]/i/text()&apos;))</span><br><span class="line">        jd = Jingdong()</span><br><span class="line">        jd.title = title</span><br><span class="line">        jd.shop = shop</span><br><span class="line">        jd.price = price</span><br><span class="line">        jd.img = img_src</span><br><span class="line">        jd.comment = commit</span><br><span class="line">        jd.icon = icon</span><br><span class="line">        # 保存数据库</span><br><span class="line">        try:</span><br><span class="line">            session.add(jd)</span><br><span class="line">            session.commit()</span><br><span class="line">        except Exception as e:</span><br><span class="line">            pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    for page in range(100):</span><br><span class="line">        page = page + 1</span><br><span class="line">        print(page)</span><br><span class="line">        html = get_page(page)</span><br><span class="line">        parse_page(html)</span><br><span class="line">    # browser.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></p>
<p>###kaisha解密文件(kaisha.py)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import urllib</span><br><span class="line">from urllib import parse</span><br><span class="line"></span><br><span class="line">def str2url(s):</span><br><span class="line">    #s = &apos;9hFaF2FF%_Et%m4F4%538t2i%795E%3pF.265E85.%fnF9742Em33e162_36pA.t6661983%x%6%%74%2i2%22735&apos;</span><br><span class="line">    num_loc = s.find(&apos;h&apos;)</span><br><span class="line">    rows = int(s[0:num_loc])</span><br><span class="line">    strlen = len(s) - num_loc</span><br><span class="line">    cols = int(strlen/rows)</span><br><span class="line">    right_rows = strlen % rows</span><br><span class="line">    new_s = list(s[num_loc:])</span><br><span class="line">    output = &apos;&apos;</span><br><span class="line">    for i in range(len(new_s)):</span><br><span class="line">        x = i % rows</span><br><span class="line">        y = i / rows</span><br><span class="line">        p = 0</span><br><span class="line">        if x &lt;= right_rows:</span><br><span class="line">            p = x * (cols + 1) + y</span><br><span class="line">        else:</span><br><span class="line">            p = right_rows * (cols + 1) + (x - right_rows) * cols + y</span><br><span class="line">        output += new_s[int(p)]</span><br><span class="line">    return parse.unquote(output).replace(&apos;^&apos;, &apos;0&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    s = &quot;6hAFxn752E5F215234uy495-3741E8t%mie15F2E185E%6at%72E%7ba%13t21at27261734458%h3%%-5a885d5pF2m%%11799662E13_D55%E992E48%%8i222%4%59358.Fk1EE5-8bc%7632..FF%5%24_%9_mae58%E513e51&quot;</span><br><span class="line">    result_str = str2url(s)</span><br><span class="line">    print(result_str)</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure></p>
<p>###自动化爬取虾米音乐<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">from selenium import webdriver</span><br><span class="line">from selenium.common.exceptions import TimeoutException</span><br><span class="line">from selenium.webdriver.common.by import By</span><br><span class="line">from selenium.webdriver.support.ui import WebDriverWait</span><br><span class="line">from selenium.webdriver.support import expected_conditions as EC</span><br><span class="line">from urllib.parse import quote</span><br><span class="line">from lxml import etree</span><br><span class="line">import kaisha</span><br><span class="line"></span><br><span class="line"># 打开一个浏览器</span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"># 设置等待时间</span><br><span class="line">wait = WebDriverWait(browser, 5)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_resourse(url):</span><br><span class="line">    headers = &#123;</span><br><span class="line">        &quot;User-Agent&quot;: &quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; 360SE)&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.get(url, headers=headers)</span><br><span class="line">    if response.status_code == 200:</span><br><span class="line">        return response.content</span><br><span class="line">    return None</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_page():</span><br><span class="line">    url = &apos;https://www.xiami.com/&apos;</span><br><span class="line">    # 访问网址</span><br><span class="line">    browser.get(url)</span><br><span class="line">    # 点击事件(方法一)</span><br><span class="line">    button = wait.until(EC.element_to_be_clickable((By.LINK_TEXT, &apos;回旧版&apos;)))</span><br><span class="line">    button.click()</span><br><span class="line">    # 点击事件(方法二)</span><br><span class="line">    button = wait.until(EC.element_to_be_clickable((By.XPATH, &apos;//div[@id = &quot;secondary&quot;]//div[@class=&quot;nav&quot;]/a[2]&apos;)))</span><br><span class="line">    button.click()</span><br><span class="line">    # 点击欧美</span><br><span class="line">    button = wait.until(EC.element_to_be_clickable((By.XPATH, &apos;//div[@id = &quot;tab&quot;]/span[3]/a&apos;)))</span><br><span class="line">    button.click()</span><br><span class="line">    # 等待加载完成，可以等待某个元素出现</span><br><span class="line">    # wait.until(EC.text_to_be_present_in_element((By.XPATH, &apos;//tr[@data-index=&quot;99&quot;]/td[@class=&quot;trackid&quot;]/text()&apos;), &apos;100&apos;))</span><br><span class="line">    time.sleep(3)</span><br><span class="line">    # 拿网页</span><br><span class="line">    return browser.page_source</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def parse_page(html):</span><br><span class="line">    etree_html = etree.HTML(html)</span><br><span class="line"></span><br><span class="line">    song_list = etree_html.xpath(&apos;//tr[@class=&quot;songwrapper&quot;]&apos;)</span><br><span class="line">    # print(mp3_lis3)</span><br><span class="line">    for song in song_list:</span><br><span class="line">        # 取歌曲链接</span><br><span class="line">        mp3_data = song.xpath(&apos;./@data-mp3&apos;)[0]</span><br><span class="line">        # 用喀什密码解密</span><br><span class="line">        mp3_url = kaisha.str2url(mp3_data)</span><br><span class="line">        # 取歌曲名</span><br><span class="line">        mp3_title = song.xpath(&apos;./@data-title&apos;)[0]</span><br><span class="line">        mp3_title = mp3_title.replace(&apos; &apos;, &apos;&apos;)</span><br><span class="line">        print(mp3_title)</span><br><span class="line">        print(mp3_url)</span><br><span class="line">        # save_mp3(mp3_url, mp3_title)</span><br><span class="line">        save_us(mp3_url, mp3_title)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def save_mp3(mp3_url, mp3_title):</span><br><span class="line">    content = get_resourse(mp3_url)</span><br><span class="line">    with open(&apos;./mp3/%s.mp3&apos; % mp3_title, &apos;wb&apos;) as f:</span><br><span class="line">        f.write(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 保存英文歌</span><br><span class="line">def save_us(mp3_url, mp3_title):</span><br><span class="line">    content = get_resourse(mp3_url)</span><br><span class="line">    with open(&apos;./us/%s.mp3&apos; % mp3_title, &apos;wb&apos;) as f:</span><br><span class="line">        f.write(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    html = get_page()</span><br><span class="line">    parse_page(html)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></p>
<p>###爬取网易云音乐榜单<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br></pre></td><td class="code"><pre><span class="line"># coding=utf-8</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">爬取网易云音乐榜单</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line"># 导入需要使用的模块</span><br><span class="line">import os</span><br><span class="line">import csv</span><br><span class="line">import time</span><br><span class="line">import random</span><br><span class="line">import requests</span><br><span class="line">import threading</span><br><span class="line">from lxml import etree</span><br><span class="line">from selenium import webdriver</span><br><span class="line"></span><br><span class="line">agents = [</span><br><span class="line">    &quot;Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727; .NET CLR 3.0.30729; .NET CLR 3.5.30729; InfoPath.3; rv:11.0) like Gecko&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0&quot;,</span><br><span class="line">    &quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0)&quot;,</span><br><span class="line">    &quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:2.0.1) Gecko/20100101 Firefox/4.0.1&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (Windows NT 6.1; rv:2.0.1) Gecko/20100101 Firefox/4.0.1&quot;,</span><br><span class="line">    &quot;Opera/9.80 (Macintosh; Intel Mac OS X 10.6.8; U; en) Presto/2.8.131 Version/11.11&quot;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class WangyiMusc(object):</span><br><span class="line"></span><br><span class="line">    # id表示你要获取排行榜</span><br><span class="line">    # mating是榜单名称</span><br><span class="line">    # url为排行榜页面</span><br><span class="line">    # music_url为歌曲下载页面</span><br><span class="line">    def __init__(self, mating, id):</span><br><span class="line">        self.browser = webdriver.Chrome()</span><br><span class="line">        self.id = id</span><br><span class="line">        self.url = &quot;https://music.163.com/#/discover/toplist?id=&#123;0&#125;&quot;.format(self.id)</span><br><span class="line">        self.music_url = &quot;http://music.163.com/song/media/outer/url?id=&#123;0&#125;.mp3&quot;</span><br><span class="line">        self.mat = mating</span><br><span class="line"></span><br><span class="line">    # 由于页面的歌曲信息都存放在页面的ifram里面，所以使用Selenium进入子页面获得代码然后返回</span><br><span class="line">    def get_html(self):</span><br><span class="line">        self.browser.get(self.url)</span><br><span class="line">        self.browser.switch_to_frame(&apos;contentFrame&apos;)</span><br><span class="line">        iframe = self.browser.page_source</span><br><span class="line">        time.sleep(5)</span><br><span class="line">        return iframe</span><br><span class="line"></span><br><span class="line">    # 使用xpath解析页面的信息进行返回</span><br><span class="line">    def parse_html(self):</span><br><span class="line">        iframe = self.get_html()</span><br><span class="line">        html = etree.HTML(iframe)</span><br><span class="line">        contents = html.xpath(&apos;//tbody/tr&apos;)</span><br><span class="line">        try:</span><br><span class="line">            for content in contents:</span><br><span class="line">                name = content.xpath(&apos;./td/div/div/div/span/a/b/@title&apos;)[0].replace(&apos; &apos;, &apos;&apos;)</span><br><span class="line">                music_id = content.xpath(&apos;./td/div/div/span/@data-res-id&apos;)[0].strip()</span><br><span class="line">                print(name)</span><br><span class="line">                print(music_id)</span><br><span class="line">                # 将歌曲的名称与id传给write_music方法进行下载</span><br><span class="line">                self.write_music(name, music_id)</span><br><span class="line">                # num = content.xpath(&apos;./td/div/span[@class=&quot;num&quot;]/text()&apos;)[0].strip()</span><br><span class="line">                # date = content.xpath(&apos;./td[@class=&quot; s-fc3&quot;]/span/text()&apos;)[0].strip()</span><br><span class="line">                # singer = content.xpath(&apos;./td/div[@class=&quot;text&quot;]/@title&apos;)[0].strip()</span><br><span class="line">                # # 将歌曲的信息构建成个元组类型</span><br><span class="line">                # items = num, name, date, singer</span><br><span class="line">                #</span><br><span class="line">                # # 每获得一次歌曲信息后返回一次</span><br><span class="line">                # yield list(items)</span><br><span class="line"></span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(&apos;解析失败！&apos;, e.args)</span><br><span class="line"></span><br><span class="line">    # 获取到目前的日期</span><br><span class="line">    def get_date(self):</span><br><span class="line">        t = time.localtime()</span><br><span class="line">        tt = time.strftime(&apos;%Y年%m月%d日&apos;, t)</span><br><span class="line">        return tt</span><br><span class="line"></span><br><span class="line">    # 得到歌曲的名称与id,这里进行下载</span><br><span class="line">    def write_music(self, name, music_id):</span><br><span class="line">        url = self.music_url.format(music_id)</span><br><span class="line">        # agent = random.choice(agents)</span><br><span class="line">        try:</span><br><span class="line">            # headers = &#123;</span><br><span class="line">            #     &apos;User-Agent&apos;: agent</span><br><span class="line">            # &#125;</span><br><span class="line">            # music = requests.get(url, headers=headers)</span><br><span class="line">            headers = &#123;</span><br><span class="line">                &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:2.0b13pre) Gecko/20110307 Firefox/4.0b13pre&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            music = requests.get(url, headers=headers)</span><br><span class="line">            if music.status_code == 200:</span><br><span class="line">                # 把歌曲保存到目前日期下的榜单名称下面,方便查看</span><br><span class="line">                # path = self.get_date() + os.sep + self.mat + os.sep</span><br><span class="line">                # 查询是否有这个地址,如果没有递归创建</span><br><span class="line">                # if not os.path.exists(path):</span><br><span class="line">                #     os.makedirs(path)</span><br><span class="line">                with open(&apos;./wangyiyun/&apos; + name + &apos;.mp3&apos;, &apos;wb&apos;) as f:</span><br><span class="line">                    f.write(music.content)</span><br><span class="line">                    print(&apos;下载 &apos; + name + &quot; 成功...&quot;)</span><br><span class="line"></span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(&quot;下载 &#123;0&#125; 失败!!!&quot;.format(name), e.args)</span><br><span class="line"></span><br><span class="line">    # 保存榜单的信息</span><br><span class="line">    def write_items(self):</span><br><span class="line">        # 将信息保存至目前日期的下面,方便查找</span><br><span class="line">        path = self.get_date() + os.sep + self.mat</span><br><span class="line">        try:</span><br><span class="line">            # 判断是否有这个文件，如果没有者创建</span><br><span class="line">            if not os.path.exists(path):</span><br><span class="line">                os.makedirs(path)</span><br><span class="line">            with open(path + &apos;榜单信息.csv&apos;, &apos;w&apos;, encoding=&apos;utf-8&apos;) as file:</span><br><span class="line">                # 使用cvs格式进行保存</span><br><span class="line">                csvfile = csv.writer(file)</span><br><span class="line">                csvfile.writerow([&apos;排名&apos;, &apos;歌名&apos;, &apos;时长&apos;, &apos;歌手&apos;])</span><br><span class="line">                for parse in self.parse_html():</span><br><span class="line">                    csvfile.writerow(parse)</span><br><span class="line">                print(&quot;存储信息成功.&quot;)</span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(&quot;存储信息失败!&quot;, e.args)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def operation(mating, id):</span><br><span class="line">    try:</span><br><span class="line">        # 实例化对象</span><br><span class="line">        music = WangyiMusc(mating, id)</span><br><span class="line">        # 获取要爬取的页面的HTML文件</span><br><span class="line">        music.get_html()</span><br><span class="line">        # 解析页面，将需要的信息进行返回,并开始下载歌曲</span><br><span class="line">        music.parse_html()</span><br><span class="line">        # 获取目前的日期</span><br><span class="line">        # music.get_date()</span><br><span class="line">        # 保存需要的信息</span><br><span class="line">        # music.write_items()</span><br><span class="line">        # print(&quot;下载完成...&quot;)</span><br><span class="line">        # 关闭browser</span><br><span class="line">        music.browser.close()</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(&quot;下载失败!&quot;, e.args)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 选择的界面</span><br><span class="line">def user_select():</span><br><span class="line">    # 每个榜单的id</span><br><span class="line">    ids = [&apos;19723756&apos;, &apos;3779629&apos;, &apos;2884035&apos;, &apos;3778678&apos;, &apos;991319590&apos;,</span><br><span class="line">           &apos;2408901803&apos;, &apos;1978921795&apos;, &apos;71385702&apos;, &apos;2462790889&apos;,</span><br><span class="line">           &apos;10520166&apos;, &apos;3812895&apos;, &apos;60131&apos;, &apos;71384707&apos;, &apos;180106&apos;, &apos;60198&apos;,</span><br><span class="line">           &apos;27135204&apos;, &apos;11641012&apos;, &apos;120001&apos;, &apos;2323534945&apos;, &apos;745956260&apos;,</span><br><span class="line">           &apos;2023401535&apos;, &apos;2006508653&apos;, &apos;21845217&apos;, &apos;112463&apos;,</span><br><span class="line">           &apos;112504&apos;, &apos;64016&apos;, &apos;10169002&apos;, &apos;1899724&apos;]</span><br><span class="line"></span><br><span class="line">    # 每个榜单的名称</span><br><span class="line">    names = [&apos;云音乐飙升榜&apos;, &apos;云音乐新歌榜&apos;, &apos;网易原创歌曲榜&apos;,</span><br><span class="line">             &apos;云音乐热歌榜&apos;, &apos;江小白YOLO云音乐说唱榜&apos;, &apos;公告牌音乐榜&apos;, &apos;云音乐电音榜&apos;,</span><br><span class="line">             &apos;云音乐电音榜&apos;, &apos;云音乐ACG音乐榜&apos;, &apos;YY音乐榜&apos;, &apos;云音乐国电榜&apos;, &apos;云音乐国电榜&apos;,</span><br><span class="line">             &apos;云音乐国电榜&apos;, &apos;云音乐古典音乐榜&apos;, &apos;UK排行榜周榜&apos;, &apos;美国Billboard周榜&apos;,</span><br><span class="line">             &apos;法国 NRJVos Hits 周榜&apos;, &apos;iTunes榜&apos;, &apos;Hit FMTop榜&apos;, &apos;说唱TOP榜&apos;, &apos;云音乐韩语榜&apos;,</span><br><span class="line">             &apos;英国Q杂志中文版周榜&apos;, &apos;电竞音乐榜&apos;, &apos;KTV唛榜&apos;, &apos;台湾Hito排行榜&apos;, &apos;中国TOP排行榜（港台榜）&apos;,</span><br><span class="line">             &apos;中国TOP排行榜（内地榜）&apos;, &apos;香港r台中文歌曲龙虎榜&apos;, &apos;中国嘻哈榜&apos;]</span><br><span class="line">    musics = &#123;&#125;</span><br><span class="line">    nums = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    # 将名称与id存放在musics字典当中</span><br><span class="line">    for mat in range(len(ids)):</span><br><span class="line">        musics[names[mat]] = ids[mat]</span><br><span class="line"></span><br><span class="line">    # 给每一个榜单设置一个编号</span><br><span class="line">    for num in range(1, len(names) + 1):</span><br><span class="line">        nums[num] = names[num - 1]</span><br><span class="line"></span><br><span class="line">    # 输入编号与榜单名称,便于查看</span><br><span class="line">    for k, v in nums.items():</span><br><span class="line">        print(k, &quot;:&quot;, v)</span><br><span class="line"></span><br><span class="line">    # 将榜单与id打包以元组的方式放入列表当中</span><br><span class="line">    music_list = list(musics.items())</span><br><span class="line"></span><br><span class="line">    # 因为使用4个线程，所以构建一个列表</span><br><span class="line">    list1 = [i for i in range(len(music_list)) if i % 4 == 0]</span><br><span class="line"></span><br><span class="line">    # 选择要下载的榜单</span><br><span class="line">    n = int(input(&apos;请输入你要下载的榜单(请输入数字,输入0全部提取):&apos;))</span><br><span class="line"></span><br><span class="line">    # 如果需要全部下载,使用多线程</span><br><span class="line">    if n == 0:</span><br><span class="line">        for t in list1:</span><br><span class="line">            t1 = threading.Thread(target=operation, args=music_list[t])</span><br><span class="line">            t2 = threading.Thread(target=operation, args=music_list[t + 1])</span><br><span class="line">            t3 = threading.Thread(target=operation, args=music_list[t + 2])</span><br><span class="line">            t4 = threading.Thread(target=operation, args=music_list[t + 3])</span><br><span class="line"></span><br><span class="line">            t1.start()</span><br><span class="line">            t2.start()</span><br><span class="line">            t3.start()</span><br><span class="line">            t4.start()</span><br><span class="line"></span><br><span class="line">            t1.join()</span><br><span class="line">            t2.join()</span><br><span class="line">            t3.join()</span><br><span class="line">            t4.join()</span><br><span class="line"></span><br><span class="line">    # 如果只是下载某个榜单,者传入榜单名称与id</span><br><span class="line">    id = musics[nums[n]]</span><br><span class="line">    mating = nums[n]</span><br><span class="line"></span><br><span class="line">    operation(mating, id)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    # 程序开始</span><br><span class="line">    user_select()</span><br></pre></td></tr></table></figure></p>

            </div>

            <!-- Post Comments -->
            

        </div>
        <!-- Copyright 版权 start -->
                <div id="copyright">
            <ul>
                <li>&copy;Powered By <a href="https://hexo.io/zh-cn/" style="border-bottom: none;">hexo</a></li>
                <li>Design: <a href="http://miccall.tech " style="border-bottom: none;">miccall</a></li>
            </ul>
            
                <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
			
        </div>
    </div>
</body>



 	
</html>
